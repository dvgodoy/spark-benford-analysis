package com.dvgodoy.spark.benford.integration

import com.dvgodoy.spark.benford.distributions.{Benford, Bootstrap}
import com.dvgodoy.spark.benford.util.{JobId, DataByLevel, ResultsByLevel, StatsCIByLevel}
import org.apache.spark.rdd.RDD
import play.api.libs.json._

class BenfordAnalysisSuite extends SparkSuite {
  protected val boot = Bootstrap()
  protected val benf = Benford()

  protected var data: DataByLevel = _
  protected var sampleRDD: RDD[StatsCIByLevel] = _
  protected var benfordRDD: RDD[StatsCIByLevel] = _
  protected var resultsRDD: RDD[ResultsByLevel] = _

  implicit val jobId = JobId("test")

  override def loadAndProcessData(): Unit = {
    val numSamples = 1000
    data =  boot.loadData(sc, "./src/test/resources/datalevels.csv")
    sampleRDD = boot.calcSampleCIs(sc, data, numSamples)
    benfordRDD = benf.calcBenfordCIs(sc, data, numSamples)
    resultsRDD = boot.calcResults(sampleRDD, benfordRDD)
  }

  test("loadData works") {
    data.dataByLevelsRDD.count() must be(3000)
  }

  test("levelIdx assignment is correct") {
    data.levels(0) must be(("L.1",0))
    data.levels(1) must be(("L.1.A",1))
    data.levels(2) must be(("L.1.A.1",2))
    data.levels(3) must be(("L.1.A.2",2))
    data.levels(4) must be(("L.1.B",1))
    data.levels(5) must be(("L.1.B.3",2))
    data.levels(6) must be(("L.1.B.4",2))
  }

  test("hierarchical pointers are correct") {
    data.hierarchy(0) must be(Array(4,1))
    data.hierarchy(1) must be(Array(2,3))
    data.hierarchy(2) must be(Array(-1))
    data.hierarchy(3) must be(Array(-1))
    data.hierarchy(4) must be(Array(6,5))
    data.hierarchy(5) must be(Array(-1))
    data.hierarchy(6) must be(Array(-1))
  }

  test("sample CIs by Group ID are correct") {
    val CI0 = Json.stringify(boot.getCIsByGroupId(sampleRDD, 0))
    CI0 must be("[{\"id\":0,\"level\":0,\"CIs\":{\"d1d2\":{\"n\":1000,\"mean\":[{\"alpha\":0.975,\"li\":14.4132480208,\"ui\":990.2867752674,\"lower\":36.969261423,\"upper\":40.4787839229,\"t0\":38.568},{\"alpha\":0.99,\"li\":6.2925373461,\"ui\":997.1244903632,\"lower\":36.6742176029,\"upper\":40.7362248519,\"t0\":38.568}],\"variance\":[{\"alpha\":0.975,\"li\":20.9411036941,\"ui\":994.5710088844,\"lower\":583.5460349472,\"upper\":708.7116935144,\"t0\":632.625376},{\"alpha\":0.99,\"li\":10.3454310009,\"ui\":999.1168446586,\"lower\":575.1564526836,\"upper\":717.8026922609,\"t0\":632.625376}],\"skewness\":[{\"alpha\":0.975,\"li\":19.6723637771,\"ui\":993.4595448131,\"lower\":0.7079945559,\"upper\":0.9463749095,\"t0\":0.8168660437},{\"alpha\":0.99,\"li\":8.6863874261,\"ui\":998.3113392204,\"lower\":0.6961341567,\"upper\":0.9615797289,\"t0\":0.8168660437}],\"kurtosis\":[{\"alpha\":0.975,\"li\":19.1163995935,\"ui\":993.5496686103,\"lower\":-0.7040212196,\"upper\":-0.1768217546,\"t0\":-0.4630422773},{\"alpha\":0.99,\"li\":9.0805605343,\"ui\":998.639789617,\"lower\":-0.7245839744,\"upper\":-0.1239063165,\"t0\":-0.4630422773}]},\"d1\":{\"n\":1000,\"mean\":[{\"alpha\":0.975,\"li\":15.0619178829,\"ui\":990.8209416951,\"lower\":3.276,\"upper\":3.6228147181,\"t0\":3.431},{\"alpha\":0.99,\"li\":6.6505685929,\"ui\":997.3744382716,\"lower\":3.252324116,\"upper\":3.6340697008,\"t0\":3.431}],\"variance\":[{\"alpha\":0.975,\"li\":22.3029059024,\"ui\":995.0416080761,\"lower\":5.6128601234,\"upper\":6.8428525679,\"t0\":6.105239},{\"alpha\":0.99,\"li\":10.9463745805,\"ui\":999.2315415843,\"lower\":5.5430754051,\"upper\":6.9047571138,\"t0\":6.105239}],\"skewness\":[{\"alpha\":0.975,\"li\":17.6904250728,\"ui\":992.4438146307,\"lower\":0.724528246,\"upper\":0.9657394637,\"t0\":0.8383566405},{\"alpha\":0.99,\"li\":7.689711214,\"ui\":997.8868327225,\"lower\":0.7127339452,\"upper\":0.9754373259,\"t0\":0.8383566405}],\"kurtosis\":[{\"alpha\":0.975,\"li\":20.6704288774,\"ui\":994.2121646101,\"lower\":-0.7184871102,\"upper\":-0.1718710033,\"t0\":-0.4674906641},{\"alpha\":0.99,\"li\":9.7728572862,\"ui\":998.8320954608,\"lower\":-0.74298615,\"upper\":-0.1172944659,\"t0\":-0.4674906641}]},\"d2\":{\"n\":1000,\"mean\":[{\"alpha\":0.975,\"li\":10.4639961567,\"ui\":986.0736863131,\"lower\":4.046,\"upper\":4.4720716968,\"t0\":4.258},{\"alpha\":0.99,\"li\":4.14543266,\"ui\":994.9669375492,\"lower\":4.0213169068,\"upper\":4.4998586181,\"t0\":4.258}],\"variance\":[{\"alpha\":0.975,\"li\":13.8601367454,\"ui\":989.6724369647,\"lower\":7.6370196248,\"upper\":8.6539987006,\"t0\":8.185436},{\"alpha\":0.99,\"li\":5.3743579252,\"ui\":996.3260000207,\"lower\":7.5790848823,\"upper\":8.7573460988,\"t0\":8.185436}],\"skewness\":[{\"alpha\":0.975,\"li\":9.6472961107,\"ui\":985.1697305193,\"lower\":-0.0435878912,\"upper\":0.1707515722,\"t0\":0.0743550775},{\"alpha\":0.99,\"li\":3.4678282352,\"ui\":994.0591362451,\"lower\":-0.0545993618,\"upper\":0.1820663513,\"t0\":0.0743550775}],\"kurtosis\":[{\"alpha\":0.975,\"li\":13.813643002,\"ui\":989.8221340424,\"lower\":-1.3037206754,\"upper\":-1.1407286741,\"t0\":-1.2302835043},{\"alpha\":0.99,\"li\":6.245329656,\"ui\":997.1408749301,\"lower\":-1.3139968358,\"upper\":-1.1315712882,\"t0\":-1.2302835043}]},\"r\":{\"n\":1000,\"pearson\":[{\"alpha\":0.975,\"li\":9.194238571,\"ui\":984.4444568895,\"lower\":0.0247770256,\"upper\":0.1676065718,\"t0\":0.0984268144},{\"alpha\":0.99,\"li\":3.3275057887,\"ui\":993.7776683034,\"lower\":0.0103310364,\"upper\":0.1760702287,\"t0\":0.0984268144}],\"alpha0\":[{\"alpha\":0.975,\"li\":21.0125202367,\"ui\":994.4102185527,\"lower\":2.7996973589,\"upper\":3.4318446629,\"t0\":3.0690492235},{\"alpha\":0.99,\"li\":10.046724758,\"ui\":998.9387182757,\"lower\":2.7760207681,\"upper\":3.4649785094,\"t0\":3.0690492235}],\"alpha1\":[{\"alpha\":0.975,\"li\":9.5104011716,\"ui\":984.8867844825,\"lower\":0.0217953699,\"upper\":0.142397561,\"t0\":0.0850048794},{\"alpha\":0.99,\"li\":3.4990239338,\"ui\":994.0586577554,\"lower\":0.0090477486,\"upper\":0.1532612329,\"t0\":0.0850048794}],\"beta0\":[{\"alpha\":0.975,\"li\":12.3743489211,\"ui\":988.3428232836,\"lower\":3.5293689135,\"upper\":4.2258631669,\"t0\":3.8669757236},{\"alpha\":0.99,\"li\":5.1297892942,\"ui\":996.1222294297,\"lower\":3.467194849,\"upper\":4.3165967789,\"t0\":3.8669757236}],\"beta1\":[{\"alpha\":0.975,\"li\":10.1277602718,\"ui\":985.7632096568,\"lower\":0.0290548763,\"upper\":0.1940377386,\"t0\":0.1139680199},{\"alpha\":0.99,\"li\":3.7662279141,\"ui\":994.4923221175,\"lower\":0.0130553982,\"upper\":0.2065329715,\"t0\":0.1139680199}]}}}]")
    val CI1 = Json.stringify(boot.getCIsByGroupId(sampleRDD, 1))
    CI1 must be("[{\"id\":1,\"level\":1,\"CIs\":{\"d1d2\":{\"n\":600,\"mean\":[{\"alpha\":0.975,\"li\":7.7016814839,\"ui\":981.6576174125,\"lower\":36.2440163164,\"upper\":40.4785627098,\"t0\":38.4766666667},{\"alpha\":0.99,\"li\":2.7599955886,\"ui\":992.4911549117,\"lower\":35.7393367193,\"upper\":40.7543476212,\"t0\":38.4766666667}],\"variance\":[{\"alpha\":0.975,\"li\":10.7740283311,\"ui\":986.5691440279,\"lower\":545.2834044111,\"upper\":683.9934220048,\"t0\":615.9761222222},{\"alpha\":0.99,\"li\":4.1081888101,\"ui\":994.9644368177,\"lower\":540.2233777227,\"upper\":697.8207063332,\"t0\":615.9761222222}],\"skewness\":[{\"alpha\":0.975,\"li\":27.8357469962,\"ui\":996.7151770056,\"lower\":0.7054089498,\"upper\":1.0323931086,\"t0\":0.8314262616},{\"alpha\":0.99,\"li\":14.0265030987,\"ui\":999.8004352391,\"lower\":0.6845663948,\"upper\":1.0575518873,\"t0\":0.8314262616}],\"kurtosis\":[{\"alpha\":0.975,\"li\":40.2224947005,\"ui\":999.420227664,\"lower\":-0.6940711972,\"upper\":0.1833244677,\"t0\":-0.444126526},{\"alpha\":0.99,\"li\":23.5224328263,\"ui\":1000,\"lower\":-0.7182784007,\"upper\":0.3474653905,\"t0\":-0.444126526}]},\"d1\":{\"n\":600,\"mean\":[{\"alpha\":0.975,\"li\":7.6562777227,\"ui\":981.6434909583,\"lower\":3.1916666667,\"upper\":3.6198590181,\"t0\":3.4166666667},{\"alpha\":0.99,\"li\":2.708482268,\"ui\":992.4081604028,\"lower\":3.1316666667,\"upper\":3.6486455055,\"t0\":3.4166666667}],\"variance\":[{\"alpha\":0.975,\"li\":9.7924517001,\"ui\":985.2391524103,\"lower\":5.26403057,\"upper\":6.6396683814,\"t0\":5.9897222222},{\"alpha\":0.99,\"li\":3.6899017669,\"ui\":994.3397144018,\"lower\":5.1961649344,\"upper\":6.7609447251,\"t0\":5.9897222222}],\"skewness\":[{\"alpha\":0.975,\"li\":30.4324437985,\"ui\":997.2748906068,\"lower\":0.7293452697,\"upper\":1.0636955747,\"t0\":0.8552433321},{\"alpha\":0.99,\"li\":15.4916740655,\"ui\":999.981279623,\"lower\":0.7106837335,\"upper\":1.0940042685,\"t0\":0.8552433321}],\"kurtosis\":[{\"alpha\":0.975,\"li\":38.0168127316,\"ui\":999.1237031686,\"lower\":-0.7011201645,\"upper\":0.1265778113,\"t0\":-0.4401653371},{\"alpha\":0.99,\"li\":21.8683065515,\"ui\":1000,\"lower\":-0.7322615922,\"upper\":0.3677063471,\"t0\":-0.4401653371}]},\"d2\":{\"n\":600,\"mean\":[{\"alpha\":0.975,\"li\":15.0625274905,\"ui\":990.6044948163,\"lower\":4.0568806019,\"upper\":4.5676575108,\"t0\":4.31},{\"alpha\":0.99,\"li\":6.000788958,\"ui\":996.818271976,\"lower\":4.0050098635,\"upper\":4.6016898182,\"t0\":4.31}],\"variance\":[{\"alpha\":0.975,\"li\":9.4919165523,\"ui\":984.7382792726,\"lower\":7.4348168717,\"upper\":8.6988180045,\"t0\":8.0872333333},{\"alpha\":0.99,\"li\":3.6102987462,\"ui\":994.17945474,\"lower\":7.3981527452,\"upper\":8.8050889692,\"t0\":8.0872333333}],\"skewness\":[{\"alpha\":0.975,\"li\":10.5988320803,\"ui\":986.3389072817,\"lower\":-0.0533412544,\"upper\":0.2151468524,\"t0\":0.0830088931},{\"alpha\":0.99,\"li\":4.0486088058,\"ui\":994.8773868527,\"lower\":-0.0736883412,\"upper\":0.232018197,\"t0\":0.0830088931}],\"kurtosis\":[{\"alpha\":0.975,\"li\":22.9158548613,\"ui\":995.4907973244,\"lower\":-1.3035902718,\"upper\":-1.0710559495,\"t0\":-1.2128782358},{\"alpha\":0.99,\"li\":11.6740705446,\"ui\":999.4982585546,\"lower\":-1.3124248973,\"upper\":-1.0595667129,\"t0\":-1.2128782358}]},\"r\":{\"n\":600,\"pearson\":[{\"alpha\":0.975,\"li\":7.7907619461,\"ui\":981.6504796042,\"lower\":-0.0304393234,\"upper\":0.1456850067,\"t0\":0.0640573854},{\"alpha\":0.99,\"li\":2.8772461135,\"ui\":992.6720670934,\"lower\":-0.0416294193,\"upper\":0.1569730773,\"t0\":0.0640573854}]}}}]")
    val CI2 = Json.stringify(boot.getCIsByGroupId(sampleRDD, 2))
    CI2 must be("[{\"id\":2,\"level\":2,\"CIs\":{\"d1d2\":{\"n\":350,\"mean\":[{\"alpha\":0.975,\"li\":11.1486082149,\"ui\":986.9592489772,\"lower\":36.4463653236,\"upper\":42.2452350235,\"t0\":39.38},{\"alpha\":0.99,\"li\":4.4650417221,\"ui\":995.3874931661,\"lower\":36.1313862215,\"upper\":42.8288731944,\"t0\":39.38}],\"variance\":[{\"alpha\":0.975,\"li\":15.9784417013,\"ui\":991.3552187277,\"lower\":583.1640065704,\"upper\":780.3738265616,\"t0\":672.0013142857},{\"alpha\":0.99,\"li\":6.7660667685,\"ui\":997.374406237,\"lower\":560.1005097616,\"upper\":790.4625664052,\"t0\":672.0013142857}],\"skewness\":[{\"alpha\":0.975,\"li\":17.8545632875,\"ui\":992.418528101,\"lower\":0.6060028166,\"upper\":0.9848277574,\"t0\":0.7842915914},{\"alpha\":0.99,\"li\":7.5227114178,\"ui\":997.7489170028,\"lower\":0.5743194671,\"upper\":1.0111001293,\"t0\":0.7842915914}],\"kurtosis\":[{\"alpha\":0.975,\"li\":18.5716134678,\"ui\":993.3862413569,\"lower\":-0.9647250106,\"upper\":-0.1558761947,\"t0\":-0.6097881532},{\"alpha\":0.99,\"li\":9.0175256588,\"ui\":998.6839650388,\"lower\":-1.0016229111,\"upper\":-0.0394309364,\"t0\":-0.6097881532}]},\"d1\":{\"n\":350,\"mean\":[{\"alpha\":0.975,\"li\":11.7929107796,\"ui\":987.7076621094,\"lower\":3.2365686157,\"upper\":3.8111624669,\"t0\":3.5142857143},{\"alpha\":0.99,\"li\":4.8250466607,\"ui\":995.8027799091,\"lower\":3.2057142857,\"upper\":3.861654298,\"t0\":3.5142857143}],\"variance\":[{\"alpha\":0.975,\"li\":14.7376493928,\"ui\":990.4053818058,\"lower\":5.6245305073,\"upper\":7.5110112969,\"t0\":6.5412244898},{\"alpha\":0.99,\"li\":5.975538173,\"ui\":996.8175346415,\"lower\":5.4725835444,\"upper\":7.6728411618,\"t0\":6.5412244898}],\"skewness\":[{\"alpha\":0.975,\"li\":17.1085829837,\"ui\":992.0398754108,\"lower\":0.606113695,\"upper\":1.0035861096,\"t0\":0.7924531207},{\"alpha\":0.99,\"li\":7.2545851567,\"ui\":997.6348366965,\"lower\":0.58028854,\"upper\":1.022577515,\"t0\":0.7924531207}],\"kurtosis\":[{\"alpha\":0.975,\"li\":20.1049794241,\"ui\":994.2675057989,\"lower\":-0.9752279294,\"upper\":-0.1534760933,\"t0\":-0.624752},{\"alpha\":0.99,\"li\":10.0176827857,\"ui\":999.0620676726,\"lower\":-1.0155524516,\"upper\":0.0158972826,\"t0\":-0.624752}]},\"d2\":{\"n\":350,\"mean\":[{\"alpha\":0.975,\"li\":9.6774279693,\"ui\":985.1148683665,\"lower\":3.8857142857,\"upper\":4.532709669,\"t0\":4.2371428571},{\"alpha\":0.99,\"li\":3.5905916162,\"ui\":994.202401892,\"lower\":3.8603031738,\"upper\":4.5868098062,\"t0\":4.2371428571}],\"variance\":[{\"alpha\":0.975,\"li\":19.7585211202,\"ui\":993.2585387734,\"lower\":6.9598682294,\"upper\":8.6622331982,\"t0\":7.7466204082},{\"alpha\":0.99,\"li\":8.2463120321,\"ui\":998.0244766662,\"lower\":6.8083702957,\"upper\":8.8458441638,\"t0\":7.7466204082}],\"skewness\":[{\"alpha\":0.975,\"li\":14.3917292937,\"ui\":990.1639698326,\"lower\":-0.0766467367,\"upper\":0.248837885,\"t0\":0.0831427871},{\"alpha\":0.99,\"li\":5.9036192845,\"ui\":996.7768529767,\"lower\":-0.1042651401,\"upper\":0.2794058599,\"t0\":0.0831427871}],\"kurtosis\":[{\"alpha\":0.975,\"li\":16.0777238782,\"ui\":991.9815043032,\"lower\":-1.3045952134,\"upper\":-0.9758183919,\"t0\":-1.1725045208},{\"alpha\":0.99,\"li\":8.0618950822,\"ui\":998.4115248923,\"lower\":-1.3188992026,\"upper\":-0.9489851786,\"t0\":-1.1725045208}]},\"r\":{\"n\":350,\"pearson\":[{\"alpha\":0.975,\"li\":8.9781369453,\"ui\":983.8298105471,\"lower\":-0.0543036963,\"upper\":0.1940672451,\"t0\":0.0711688614},{\"alpha\":0.99,\"li\":3.4402518917,\"ui\":993.837724089,\"lower\":-0.0755363384,\"upper\":0.211597461,\"t0\":0.0711688614}]}}}]")
    val CI3 = Json.stringify(boot.getCIsByGroupId(sampleRDD, 3))
    CI3 must be("[{\"id\":3,\"level\":2,\"CIs\":{\"d1d2\":{\"n\":250,\"mean\":[{\"alpha\":0.975,\"li\":13.2002890058,\"ui\":989.1050640823,\"lower\":33.8817535802,\"upper\":40.4624381021,\"t0\":37.212},{\"alpha\":0.99,\"li\":4.9691311019,\"ui\":995.9614145628,\"lower\":33.0474384338,\"upper\":41.0976527951,\"t0\":37.212}],\"variance\":[{\"alpha\":0.975,\"li\":18.2891543892,\"ui\":992.57934707,\"lower\":429.4412349472,\"upper\":642.4563228815,\"t0\":534.799056},{\"alpha\":0.99,\"li\":7.5855420984,\"ui\":997.7465800536,\"lower\":413.7009735133,\"upper\":667.3645939179,\"t0\":534.799056}],\"skewness\":[{\"alpha\":0.975,\"li\":17.1658013944,\"ui\":992.3328761588,\"lower\":0.6614877124,\"upper\":1.1486810642,\"t0\":0.8779799909},{\"alpha\":0.99,\"li\":7.8386178059,\"ui\":998.0635943235,\"lower\":0.6187213969,\"upper\":1.1896832546,\"t0\":0.8779799909}],\"kurtosis\":[{\"alpha\":0.975,\"li\":30.0452184165,\"ui\":998.3002397443,\"lower\":-0.6792115463,\"upper\":0.7476277511,\"t0\":-0.2295633073},{\"alpha\":0.99,\"li\":17.5796248769,\"ui\":1000,\"lower\":-0.7216662321,\"upper\":1.0237338594,\"t0\":-0.2295633073}]},\"d1\":{\"n\":250,\"mean\":[{\"alpha\":0.975,\"li\":10.6955602425,\"ui\":986.5486764711,\"lower\":2.9496339865,\"upper\":3.5901652352,\"t0\":3.28},{\"alpha\":0.99,\"li\":3.9056048562,\"ui\":994.7367850677,\"lower\":2.8476634359,\"upper\":3.648679113,\"t0\":3.28}],\"variance\":[{\"alpha\":0.975,\"li\":17.3141297257,\"ui\":992.0841919004,\"lower\":4.1627957623,\"upper\":6.2041449749,\"t0\":5.1856},{\"alpha\":0.99,\"li\":7.1855609666,\"ui\":997.5623256308,\"lower\":3.9724358149,\"upper\":6.556115088,\"t0\":5.1856}],\"skewness\":[{\"alpha\":0.975,\"li\":17.4213043858,\"ui\":992.5886123739,\"lower\":0.7029784141,\"upper\":1.2223797368,\"t0\":0.9293346587},{\"alpha\":0.99,\"li\":8.1682184901,\"ui\":998.270197868,\"lower\":0.6602024319,\"upper\":1.2632093937,\"t0\":0.9293346587}],\"kurtosis\":[{\"alpha\":0.975,\"li\":30.2287959699,\"ui\":998.3744861551,\"lower\":-0.6545020883,\"upper\":0.8220999786,\"t0\":-0.1820659989},{\"alpha\":0.99,\"li\":17.777616083,\"ui\":1000,\"lower\":-0.6771975745,\"upper\":1.0596685483,\"t0\":-0.1820659989}]},\"d2\":{\"n\":250,\"mean\":[{\"alpha\":0.975,\"li\":18.8279522742,\"ui\":993.4327718643,\"lower\":4.0273247798,\"upper\":4.897673701,\"t0\":4.412},{\"alpha\":0.99,\"li\":8.9884246409,\"ui\":998.6240581144,\"lower\":3.9679559795,\"upper\":5.0646392126,\"t0\":4.412}],\"variance\":[{\"alpha\":0.975,\"li\":11.3384272749,\"ui\":987.3243531771,\"lower\":7.5019078777,\"upper\":9.4639753135,\"t0\":8.546256},{\"alpha\":0.99,\"li\":4.0505605964,\"ui\":994.9682699741,\"lower\":7.3425753086,\"upper\":9.5793946172,\"t0\":8.546256}],\"skewness\":[{\"alpha\":0.975,\"li\":5.1153732117,\"ui\":976.6591381117,\"lower\":-0.2165558492,\"upper\":0.2572774064,\"t0\":0.0731222049},{\"alpha\":0.99,\"li\":1.4168526721,\"ui\":988.6852808502,\"lower\":-0.2851199093,\"upper\":0.2726916675,\"t0\":0.0731222049}],\"kurtosis\":[{\"alpha\":0.975,\"li\":17.1699647039,\"ui\":993.0349169966,\"lower\":-1.3906971017,\"upper\":-1.0781024107,\"t0\":-1.2736169607},{\"alpha\":0.99,\"li\":9.1300008412,\"ui\":999.0192052915,\"lower\":-1.3995485007,\"upper\":-0.9957375116,\"t0\":-1.2736169607}]},\"r\":{\"n\":250,\"pearson\":[{\"alpha\":0.975,\"li\":9.9563550089,\"ui\":985.4733049156,\"lower\":-0.0785936001,\"upper\":0.1888972492,\"t0\":0.0577785968},{\"alpha\":0.99,\"li\":3.7631995072,\"ui\":994.4558962573,\"lower\":-0.101028498,\"upper\":0.2064960591,\"t0\":0.0577785968}]}}}]")
    val CI4 = Json.stringify(boot.getCIsByGroupId(sampleRDD, 4))
    CI4 must be("[{\"id\":4,\"level\":1,\"CIs\":{\"d1d2\":{\"n\":400,\"mean\":[{\"alpha\":0.975,\"li\":15.6484978447,\"ui\":991.259801465,\"lower\":36.1330954577,\"upper\":41.8062554336,\"t0\":38.705},{\"alpha\":0.99,\"li\":6.9413770428,\"ui\":997.5537988299,\"lower\":35.9066747157,\"upper\":42.0099908581,\"t0\":38.705}],\"variance\":[{\"alpha\":0.975,\"li\":14.4202841466,\"ui\":990.1442415833,\"lower\":567.7315608856,\"upper\":752.8274641622,\"t0\":657.567975},{\"alpha\":0.99,\"li\":5.7577901905,\"ui\":996.6459593852,\"lower\":548.2048914919,\"upper\":763.1995041253,\"t0\":657.567975}],\"skewness\":[{\"alpha\":0.975,\"li\":16.5738822517,\"ui\":991.7914287015,\"lower\":0.613728507,\"upper\":1.0085163781,\"t0\":0.795359968},{\"alpha\":0.99,\"li\":7.171749893,\"ui\":997.6311316075,\"lower\":0.5913386751,\"upper\":1.0401580743,\"t0\":0.795359968}],\"kurtosis\":[{\"alpha\":0.975,\"li\":33.3383951546,\"ui\":998.3608677517,\"lower\":-0.7981309119,\"upper\":0.0955451142,\"t0\":-0.4949639003},{\"alpha\":0.99,\"li\":18.5292534366,\"ui\":1000,\"lower\":-0.8289020932,\"upper\":0.2814815773,\"t0\":-0.4949639003}]},\"d1\":{\"n\":400,\"mean\":[{\"alpha\":0.975,\"li\":14.7817105074,\"ui\":990.6229641092,\"lower\":3.1975,\"upper\":3.7511314022,\"t0\":3.4525},{\"alpha\":0.99,\"li\":6.5811066767,\"ui\":997.3447503413,\"lower\":3.1789938931,\"upper\":3.7825,\"t0\":3.4525}],\"variance\":[{\"alpha\":0.975,\"li\":13.322029992,\"ui\":989.2502193225,\"lower\":5.4425760729,\"upper\":7.1768599185,\"t0\":6.27774375},{\"alpha\":0.99,\"li\":5.3395958343,\"ui\":996.3089650131,\"lower\":5.2657429694,\"upper\":7.2562509677,\"t0\":6.27774375}],\"skewness\":[{\"alpha\":0.975,\"li\":16.2208767922,\"ui\":991.5674843119,\"lower\":0.6253289154,\"upper\":1.0261951359,\"t0\":0.8133183961},{\"alpha\":0.99,\"li\":7.0094658908,\"ui\":997.5434503459,\"lower\":0.6027650801,\"upper\":1.0452939021,\"t0\":0.8133183961}],\"kurtosis\":[{\"alpha\":0.975,\"li\":31.6914106538,\"ui\":998.046339394,\"lower\":-0.8216670468,\"upper\":0.053445836,\"t0\":-0.5086785567},{\"alpha\":0.99,\"li\":17.4213645121,\"ui\":1000,\"lower\":-0.8592293975,\"upper\":0.1973911275,\"t0\":-0.5086785567}]},\"d2\":{\"n\":400,\"mean\":[{\"alpha\":0.975,\"li\":17.934247697,\"ui\":992.7127015769,\"lower\":3.875,\"upper\":4.5125,\"t0\":4.18},{\"alpha\":0.99,\"li\":8.0826930469,\"ui\":998.1357424211,\"lower\":3.8279336913,\"upper\":4.6161618309,\"t0\":4.18}],\"variance\":[{\"alpha\":0.975,\"li\":23.505077714,\"ui\":995.2937346128,\"lower\":7.6285131782,\"upper\":9.319984747,\"t0\":8.3226},{\"alpha\":0.99,\"li\":11.275180698,\"ui\":999.2249394873,\"lower\":7.5159969984,\"upper\":9.5622713521,\"t0\":8.3226}],\"skewness\":[{\"alpha\":0.975,\"li\":4.800798052,\"ui\":974.7723596754,\"lower\":-0.1468009791,\"upper\":0.196139743,\"t0\":0.0643472263},{\"alpha\":0.99,\"li\":1.4162474014,\"ui\":988.0834915007,\"lower\":-0.179339258,\"upper\":0.2266598035,\"t0\":0.0643472263}],\"kurtosis\":[{\"alpha\":0.975,\"li\":13.0485920892,\"ui\":989.0603810366,\"lower\":-1.3693450483,\"upper\":-1.1277274725,\"t0\":-1.2604129665},{\"alpha\":0.99,\"li\":5.803864494,\"ui\":996.7773413305,\"lower\":-1.3780234679,\"upper\":-1.1018634817,\"t0\":-1.2604129665}]},\"r\":{\"n\":400,\"pearson\":[{\"alpha\":0.975,\"li\":13.0018207204,\"ui\":988.9524080679,\"lower\":0.0314673433,\"upper\":0.2626240338,\"t0\":0.148522063},{\"alpha\":0.99,\"li\":5.1260759456,\"ui\":996.1110974668,\"lower\":0.020785244,\"upper\":0.2783651445,\"t0\":0.148522063}]}}}]")
    val CI5 = Json.stringify(boot.getCIsByGroupId(sampleRDD, 5))
    CI5 must be("[{\"id\":5,\"level\":2,\"CIs\":{\"d1d2\":{\"n\":180,\"mean\":[{\"alpha\":0.975,\"li\":5.8073716523,\"ui\":976.6231606458,\"lower\":34.7469920315,\"upper\":43.9478840266,\"t0\":40.0166666667},{\"alpha\":0.99,\"li\":2.0166460421,\"ui\":990.0019842986,\"lower\":34.2033435767,\"upper\":44.5389312107,\"t0\":40.0166666667}],\"variance\":[{\"alpha\":0.975,\"li\":9.5988582479,\"ui\":985.0734899103,\"lower\":520.3916244577,\"upper\":801.0418208596,\"t0\":666.9830555556},{\"alpha\":0.99,\"li\":3.477049421,\"ui\":994.0570315754,\"lower\":491.519849178,\"upper\":817.8309535805,\"t0\":666.9830555556}],\"skewness\":[{\"alpha\":0.975,\"li\":41.3862946181,\"ui\":999.0673356735,\"lower\":0.5757923393,\"upper\":1.2172584705,\"t0\":0.7907282465},{\"alpha\":0.99,\"li\":22.7470782823,\"ui\":1000,\"lower\":0.5564177485,\"upper\":1.2675371042,\"t0\":0.7907282465}],\"kurtosis\":[{\"alpha\":0.975,\"li\":55.1677585604,\"ui\":1000,\"lower\":-0.837918163,\"upper\":0.8265520373,\"t0\":-0.4471283195},{\"alpha\":0.99,\"li\":35.8988059566,\"ui\":1000,\"lower\":-0.8636094096,\"upper\":0.8265520373,\"t0\":-0.4471283195}]},\"d1\":{\"n\":180,\"mean\":[{\"alpha\":0.975,\"li\":5.7923357986,\"ui\":976.7074524825,\"lower\":3.0790047113,\"upper\":3.9444444444,\"t0\":3.5722222222},{\"alpha\":0.99,\"li\":1.9886215368,\"ui\":989.9637487671,\"lower\":2.9773535561,\"upper\":4.0273599343,\"t0\":3.5722222222}],\"variance\":[{\"alpha\":0.975,\"li\":7.6317279854,\"ui\":981.8008098378,\"lower\":4.9971026423,\"upper\":7.5789293496,\"t0\":6.378117284},{\"alpha\":0.99,\"li\":2.6132298776,\"ui\":992.292580799,\"lower\":4.5322019139,\"upper\":7.7598987573,\"t0\":6.378117284}],\"skewness\":[{\"alpha\":0.975,\"li\":38.5231419046,\"ui\":998.8782391695,\"lower\":0.5841853874,\"upper\":1.2352178797,\"t0\":0.8051385927},{\"alpha\":0.99,\"li\":21.3004677619,\"ui\":1000,\"lower\":0.5605223575,\"upper\":1.3009484491,\"t0\":0.8051385927}],\"kurtosis\":[{\"alpha\":0.975,\"li\":60.5281861861,\"ui\":1000,\"lower\":-0.8562465996,\"upper\":0.8812661781,\"t0\":-0.4734035738},{\"alpha\":0.99,\"li\":40.3282467353,\"ui\":1000,\"lower\":-0.8821434194,\"upper\":0.8812661781,\"t0\":-0.4734035738}]},\"d2\":{\"n\":180,\"mean\":[{\"alpha\":0.975,\"li\":7.5588555196,\"ui\":980.7677557257,\"lower\":3.8254070779,\"upper\":4.7264668863,\"t0\":4.2944444444},{\"alpha\":0.99,\"li\":2.9149560946,\"ui\":992.5729951221,\"lower\":3.8087037663,\"upper\":4.8253349298,\"t0\":4.2944444444}],\"variance\":[{\"alpha\":0.975,\"li\":24.3188821042,\"ui\":994.9808271754,\"lower\":6.2906712675,\"upper\":8.5681026307,\"t0\":7.3188580247},{\"alpha\":0.99,\"li\":10.5751067572,\"ui\":998.7900677747,\"lower\":6.0792705997,\"upper\":8.8000811069,\"t0\":7.3188580247}],\"skewness\":[{\"alpha\":0.975,\"li\":13.9182638535,\"ui\":989.6681535679,\"lower\":-0.2184477589,\"upper\":0.2830315861,\"t0\":0.0507033364},{\"alpha\":0.99,\"li\":5.143148943,\"ui\":996.1173579855,\"lower\":-0.2787852081,\"upper\":0.3211403321,\"t0\":0.0507033364}],\"kurtosis\":[{\"alpha\":0.975,\"li\":11.6466109036,\"ui\":987.253534391,\"lower\":-1.3029308939,\"upper\":-0.8804309576,\"t0\":-1.1354640171},{\"alpha\":0.99,\"li\":5.9390650986,\"ui\":997.0717748386,\"lower\":-1.3313714608,\"upper\":-0.8172480116,\"t0\":-1.1354640171}]},\"r\":{\"n\":180,\"pearson\":[{\"alpha\":0.975,\"li\":17.7728378564,\"ui\":992.463664576,\"lower\":0.0159832748,\"upper\":0.3279569417,\"t0\":0.1599199363},{\"alpha\":0.99,\"li\":7.6750660173,\"ui\":997.8665628691,\"lower\":-0.004359526,\"upper\":0.3628075546,\"t0\":0.1599199363}]}}}]")
    val CI6 = Json.stringify(boot.getCIsByGroupId(sampleRDD, 6))
    CI6 must be("[{\"id\":6,\"level\":2,\"CIs\":{\"d1d2\":{\"n\":220,\"mean\":[{\"alpha\":0.975,\"li\":16.6394477962,\"ui\":991.7689838875,\"lower\":33.9620245355,\"upper\":41.6334872337,\"t0\":37.6318181818},{\"alpha\":0.99,\"li\":7.0562899266,\"ui\":997.5347789375,\"lower\":33.396701995,\"upper\":42.2187578131,\"t0\":37.6318181818}],\"variance\":[{\"alpha\":0.975,\"li\":21.4319697673,\"ui\":994.142221247,\"lower\":536.7521813648,\"upper\":773.2633186764,\"t0\":647.3053512397},{\"alpha\":0.99,\"li\":9.4418613597,\"ui\":998.5414515378,\"lower\":525.509818053,\"upper\":805.6394233689,\"t0\":647.3053512397}],\"skewness\":[{\"alpha\":0.975,\"li\":21.3732258864,\"ui\":994.77173031,\"lower\":0.5760330655,\"upper\":1.1528422171,\"t0\":0.8000684753},{\"alpha\":0.99,\"li\":10.6116343799,\"ui\":999.1957592868,\"lower\":0.5436895811,\"upper\":1.2579071919,\"t0\":0.8000684753}],\"kurtosis\":[{\"alpha\":0.975,\"li\":41.2708370693,\"ui\":999.9746603826,\"lower\":-0.9218156043,\"upper\":0.6132300636,\"t0\":-0.5461403995},{\"alpha\":0.99,\"li\":25.8538905928,\"ui\":1000,\"lower\":-0.9623633261,\"upper\":0.6159854095,\"t0\":-0.5461403995}]},\"d1\":{\"n\":220,\"mean\":[{\"alpha\":0.975,\"li\":14.1831849746,\"ui\":990.0226246574,\"lower\":2.9963076812,\"upper\":3.7319169653,\"t0\":3.3545454545},{\"alpha\":0.99,\"li\":5.9103685259,\"ui\":996.7967686892,\"lower\":2.931060649,\"upper\":3.7949988974,\"t0\":3.3545454545}],\"variance\":[{\"alpha\":0.975,\"li\":20.0829712284,\"ui\":993.5794304548,\"lower\":5.1302092745,\"upper\":7.3699636042,\"t0\":6.1742975207},{\"alpha\":0.99,\"li\":8.7626604132,\"ui\":998.3076894068,\"lower\":5.0272599065,\"upper\":7.5891705727,\"t0\":6.1742975207}],\"skewness\":[{\"alpha\":0.975,\"li\":21.2063022576,\"ui\":994.6864377946,\"lower\":0.5958430878,\"upper\":1.1487462574,\"t0\":0.8205086823},{\"alpha\":0.99,\"li\":10.4937366,\"ui\":999.1575662356,\"lower\":0.5670744105,\"upper\":1.2689932602,\"t0\":0.8205086823}],\"kurtosis\":[{\"alpha\":0.975,\"li\":38.9394641045,\"ui\":999.6967311091,\"lower\":-0.9370268092,\"upper\":0.5630366347,\"t0\":-0.5482374624},{\"alpha\":0.99,\"li\":23.9513561535,\"ui\":1000,\"lower\":-0.9577295528,\"upper\":0.5725950528,\"t0\":-0.5482374624}]},\"d2\":{\"n\":220,\"mean\":[{\"alpha\":0.975,\"li\":18.1551871245,\"ui\":992.800609846,\"lower\":3.677992005,\"upper\":4.5844743053,\"t0\":4.0863636364},{\"alpha\":0.99,\"li\":8.1258126384,\"ui\":998.1365679697,\"lower\":3.5848104143,\"upper\":4.6376060579,\"t0\":4.0863636364}],\"variance\":[{\"alpha\":0.975,\"li\":17.1440477777,\"ui\":991.7947229588,\"lower\":7.980915859,\"upper\":10.2154286707,\"t0\":9.1243595041},{\"alpha\":0.99,\"li\":6.6489344915,\"ui\":997.1828989953,\"lower\":7.7837573877,\"upper\":10.4192063158,\"t0\":9.1243595041}],\"skewness\":[{\"alpha\":0.975,\"li\":11.1619466681,\"ui\":987.0364864796,\"lower\":-0.1566231354,\"upper\":0.3208682898,\"t0\":0.0905031999},{\"alpha\":0.99,\"li\":4.2876568498,\"ui\":995.1976590015,\"lower\":-0.1870047976,\"upper\":0.361528334,\"t0\":0.0905031999}],\"kurtosis\":[{\"alpha\":0.975,\"li\":15.98061042,\"ui\":992.2508190477,\"lower\":-1.4615463339,\"upper\":-1.1623852835,\"t0\":-1.3547827181},{\"alpha\":0.99,\"li\":8.6571312226,\"ui\":998.9138431323,\"lower\":-1.4827396504,\"upper\":-1.1456582627,\"t0\":-1.3547827181}]},\"r\":{\"n\":220,\"pearson\":[{\"alpha\":0.975,\"li\":11.2711547181,\"ui\":987.1480325591,\"lower\":-0.0137464975,\"upper\":0.283614278,\"t0\":0.1382353384},{\"alpha\":0.99,\"li\":4.391641576,\"ui\":995.3174029525,\"lower\":-0.0305695917,\"upper\":0.296468908,\"t0\":0.1382353384}]}}}]")
  }

  test("sample CIs by Level are correct") {
    val CI1 = boot.getCIsByLevel(sampleRDD, 1)
    Json.stringify(CI1) must be ("[{\"id\":4,\"level\":1,\"CIs\":{\"d1d2\":{\"n\":400,\"mean\":[{\"alpha\":0.975,\"li\":15.6484978447,\"ui\":991.259801465,\"lower\":36.1330954577,\"upper\":41.8062554336,\"t0\":38.705},{\"alpha\":0.99,\"li\":6.9413770428,\"ui\":997.5537988299,\"lower\":35.9066747157,\"upper\":42.0099908581,\"t0\":38.705}],\"variance\":[{\"alpha\":0.975,\"li\":14.4202841466,\"ui\":990.1442415833,\"lower\":567.7315608856,\"upper\":752.8274641622,\"t0\":657.567975},{\"alpha\":0.99,\"li\":5.7577901905,\"ui\":996.6459593852,\"lower\":548.2048914919,\"upper\":763.1995041253,\"t0\":657.567975}],\"skewness\":[{\"alpha\":0.975,\"li\":16.5738822517,\"ui\":991.7914287015,\"lower\":0.613728507,\"upper\":1.0085163781,\"t0\":0.795359968},{\"alpha\":0.99,\"li\":7.171749893,\"ui\":997.6311316075,\"lower\":0.5913386751,\"upper\":1.0401580743,\"t0\":0.795359968}],\"kurtosis\":[{\"alpha\":0.975,\"li\":33.3383951546,\"ui\":998.3608677517,\"lower\":-0.7981309119,\"upper\":0.0955451142,\"t0\":-0.4949639003},{\"alpha\":0.99,\"li\":18.5292534366,\"ui\":1000,\"lower\":-0.8289020932,\"upper\":0.2814815773,\"t0\":-0.4949639003}]},\"d1\":{\"n\":400,\"mean\":[{\"alpha\":0.975,\"li\":14.7817105074,\"ui\":990.6229641092,\"lower\":3.1975,\"upper\":3.7511314022,\"t0\":3.4525},{\"alpha\":0.99,\"li\":6.5811066767,\"ui\":997.3447503413,\"lower\":3.1789938931,\"upper\":3.7825,\"t0\":3.4525}],\"variance\":[{\"alpha\":0.975,\"li\":13.322029992,\"ui\":989.2502193225,\"lower\":5.4425760729,\"upper\":7.1768599185,\"t0\":6.27774375},{\"alpha\":0.99,\"li\":5.3395958343,\"ui\":996.3089650131,\"lower\":5.2657429694,\"upper\":7.2562509677,\"t0\":6.27774375}],\"skewness\":[{\"alpha\":0.975,\"li\":16.2208767922,\"ui\":991.5674843119,\"lower\":0.6253289154,\"upper\":1.0261951359,\"t0\":0.8133183961},{\"alpha\":0.99,\"li\":7.0094658908,\"ui\":997.5434503459,\"lower\":0.6027650801,\"upper\":1.0452939021,\"t0\":0.8133183961}],\"kurtosis\":[{\"alpha\":0.975,\"li\":31.6914106538,\"ui\":998.046339394,\"lower\":-0.8216670468,\"upper\":0.053445836,\"t0\":-0.5086785567},{\"alpha\":0.99,\"li\":17.4213645121,\"ui\":1000,\"lower\":-0.8592293975,\"upper\":0.1973911275,\"t0\":-0.5086785567}]},\"d2\":{\"n\":400,\"mean\":[{\"alpha\":0.975,\"li\":17.934247697,\"ui\":992.7127015769,\"lower\":3.875,\"upper\":4.5125,\"t0\":4.18},{\"alpha\":0.99,\"li\":8.0826930469,\"ui\":998.1357424211,\"lower\":3.8279336913,\"upper\":4.6161618309,\"t0\":4.18}],\"variance\":[{\"alpha\":0.975,\"li\":23.505077714,\"ui\":995.2937346128,\"lower\":7.6285131782,\"upper\":9.319984747,\"t0\":8.3226},{\"alpha\":0.99,\"li\":11.275180698,\"ui\":999.2249394873,\"lower\":7.5159969984,\"upper\":9.5622713521,\"t0\":8.3226}],\"skewness\":[{\"alpha\":0.975,\"li\":4.800798052,\"ui\":974.7723596754,\"lower\":-0.1468009791,\"upper\":0.196139743,\"t0\":0.0643472263},{\"alpha\":0.99,\"li\":1.4162474014,\"ui\":988.0834915007,\"lower\":-0.179339258,\"upper\":0.2266598035,\"t0\":0.0643472263}],\"kurtosis\":[{\"alpha\":0.975,\"li\":13.0485920892,\"ui\":989.0603810366,\"lower\":-1.3693450483,\"upper\":-1.1277274725,\"t0\":-1.2604129665},{\"alpha\":0.99,\"li\":5.803864494,\"ui\":996.7773413305,\"lower\":-1.3780234679,\"upper\":-1.1018634817,\"t0\":-1.2604129665}]},\"r\":{\"n\":400,\"pearson\":[{\"alpha\":0.975,\"li\":13.0018207204,\"ui\":988.9524080679,\"lower\":0.0314673433,\"upper\":0.2626240338,\"t0\":0.148522063},{\"alpha\":0.99,\"li\":5.1260759456,\"ui\":996.1110974668,\"lower\":0.020785244,\"upper\":0.2783651445,\"t0\":0.148522063}]}}},{\"id\":1,\"level\":1,\"CIs\":{\"d1d2\":{\"n\":600,\"mean\":[{\"alpha\":0.975,\"li\":7.7016814839,\"ui\":981.6576174125,\"lower\":36.2440163164,\"upper\":40.4785627098,\"t0\":38.4766666667},{\"alpha\":0.99,\"li\":2.7599955886,\"ui\":992.4911549117,\"lower\":35.7393367193,\"upper\":40.7543476212,\"t0\":38.4766666667}],\"variance\":[{\"alpha\":0.975,\"li\":10.7740283311,\"ui\":986.5691440279,\"lower\":545.2834044111,\"upper\":683.9934220048,\"t0\":615.9761222222},{\"alpha\":0.99,\"li\":4.1081888101,\"ui\":994.9644368177,\"lower\":540.2233777227,\"upper\":697.8207063332,\"t0\":615.9761222222}],\"skewness\":[{\"alpha\":0.975,\"li\":27.8357469962,\"ui\":996.7151770056,\"lower\":0.7054089498,\"upper\":1.0323931086,\"t0\":0.8314262616},{\"alpha\":0.99,\"li\":14.0265030987,\"ui\":999.8004352391,\"lower\":0.6845663948,\"upper\":1.0575518873,\"t0\":0.8314262616}],\"kurtosis\":[{\"alpha\":0.975,\"li\":40.2224947005,\"ui\":999.420227664,\"lower\":-0.6940711972,\"upper\":0.1833244677,\"t0\":-0.444126526},{\"alpha\":0.99,\"li\":23.5224328263,\"ui\":1000,\"lower\":-0.7182784007,\"upper\":0.3474653905,\"t0\":-0.444126526}]},\"d1\":{\"n\":600,\"mean\":[{\"alpha\":0.975,\"li\":7.6562777227,\"ui\":981.6434909583,\"lower\":3.1916666667,\"upper\":3.6198590181,\"t0\":3.4166666667},{\"alpha\":0.99,\"li\":2.708482268,\"ui\":992.4081604028,\"lower\":3.1316666667,\"upper\":3.6486455055,\"t0\":3.4166666667}],\"variance\":[{\"alpha\":0.975,\"li\":9.7924517001,\"ui\":985.2391524103,\"lower\":5.26403057,\"upper\":6.6396683814,\"t0\":5.9897222222},{\"alpha\":0.99,\"li\":3.6899017669,\"ui\":994.3397144018,\"lower\":5.1961649344,\"upper\":6.7609447251,\"t0\":5.9897222222}],\"skewness\":[{\"alpha\":0.975,\"li\":30.4324437985,\"ui\":997.2748906068,\"lower\":0.7293452697,\"upper\":1.0636955747,\"t0\":0.8552433321},{\"alpha\":0.99,\"li\":15.4916740655,\"ui\":999.981279623,\"lower\":0.7106837335,\"upper\":1.0940042685,\"t0\":0.8552433321}],\"kurtosis\":[{\"alpha\":0.975,\"li\":38.0168127316,\"ui\":999.1237031686,\"lower\":-0.7011201645,\"upper\":0.1265778113,\"t0\":-0.4401653371},{\"alpha\":0.99,\"li\":21.8683065515,\"ui\":1000,\"lower\":-0.7322615922,\"upper\":0.3677063471,\"t0\":-0.4401653371}]},\"d2\":{\"n\":600,\"mean\":[{\"alpha\":0.975,\"li\":15.0625274905,\"ui\":990.6044948163,\"lower\":4.0568806019,\"upper\":4.5676575108,\"t0\":4.31},{\"alpha\":0.99,\"li\":6.000788958,\"ui\":996.818271976,\"lower\":4.0050098635,\"upper\":4.6016898182,\"t0\":4.31}],\"variance\":[{\"alpha\":0.975,\"li\":9.4919165523,\"ui\":984.7382792726,\"lower\":7.4348168717,\"upper\":8.6988180045,\"t0\":8.0872333333},{\"alpha\":0.99,\"li\":3.6102987462,\"ui\":994.17945474,\"lower\":7.3981527452,\"upper\":8.8050889692,\"t0\":8.0872333333}],\"skewness\":[{\"alpha\":0.975,\"li\":10.5988320803,\"ui\":986.3389072817,\"lower\":-0.0533412544,\"upper\":0.2151468524,\"t0\":0.0830088931},{\"alpha\":0.99,\"li\":4.0486088058,\"ui\":994.8773868527,\"lower\":-0.0736883412,\"upper\":0.232018197,\"t0\":0.0830088931}],\"kurtosis\":[{\"alpha\":0.975,\"li\":22.9158548613,\"ui\":995.4907973244,\"lower\":-1.3035902718,\"upper\":-1.0710559495,\"t0\":-1.2128782358},{\"alpha\":0.99,\"li\":11.6740705446,\"ui\":999.4982585546,\"lower\":-1.3124248973,\"upper\":-1.0595667129,\"t0\":-1.2128782358}]},\"r\":{\"n\":600,\"pearson\":[{\"alpha\":0.975,\"li\":7.7907619461,\"ui\":981.6504796042,\"lower\":-0.0304393234,\"upper\":0.1456850067,\"t0\":0.0640573854},{\"alpha\":0.99,\"li\":2.8772461135,\"ui\":992.6720670934,\"lower\":-0.0416294193,\"upper\":0.1569730773,\"t0\":0.0640573854}]}}}]")
  }

  test("results by Group ID are correct") {
    val r0 = Json.stringify(boot.getResultsByGroupId(resultsRDD, 0))
    r0 must be("[{\"id\":0,\"level\":0,\"results\":{\"n\":1000,\"statsDiag\":true,\"regsDiag\":true,\"d1d2\":{\"mean\":{\"overlaps\":true,\"contains\":true},\"variance\":{\"overlaps\":true,\"contains\":true},\"skewness\":{\"overlaps\":true,\"contains\":true},\"kurtosis\":{\"overlaps\":true,\"contains\":true}},\"d1\":{\"mean\":{\"overlaps\":true,\"contains\":true},\"variance\":{\"overlaps\":true,\"contains\":true},\"skewness\":{\"overlaps\":true,\"contains\":true},\"kurtosis\":{\"overlaps\":true,\"contains\":true}},\"d2\":{\"mean\":{\"overlaps\":true,\"contains\":true},\"variance\":{\"overlaps\":true,\"contains\":true},\"skewness\":{\"overlaps\":true,\"contains\":true},\"kurtosis\":{\"overlaps\":true,\"contains\":true}},\"reg\":{\"pearson\":{\"overlaps\":true,\"contains\":true},\"alpha0\":{\"overlaps\":true,\"contains\":true},\"alpha1\":{\"overlaps\":true,\"contains\":true},\"beta0\":{\"overlaps\":true,\"contains\":true},\"beta1\":{\"overlaps\":true,\"contains\":true}}}}]")
    val r1 = Json.stringify(boot.getResultsByGroupId(resultsRDD, 1))
    r1 must be("[{\"id\":1,\"level\":1,\"results\":{\"n\":600,\"statsDiag\":true,\"d1d2\":{\"mean\":{\"overlaps\":true,\"contains\":true},\"variance\":{\"overlaps\":true,\"contains\":true},\"skewness\":{\"overlaps\":true,\"contains\":true},\"kurtosis\":{\"overlaps\":true,\"contains\":true}},\"d1\":{\"mean\":{\"overlaps\":true,\"contains\":true},\"variance\":{\"overlaps\":true,\"contains\":true},\"skewness\":{\"overlaps\":true,\"contains\":true},\"kurtosis\":{\"overlaps\":true,\"contains\":true}},\"d2\":{\"mean\":{\"overlaps\":true,\"contains\":true},\"variance\":{\"overlaps\":true,\"contains\":true},\"skewness\":{\"overlaps\":true,\"contains\":true},\"kurtosis\":{\"overlaps\":true,\"contains\":true}},\"reg\":{\"pearson\":{\"overlaps\":true,\"contains\":true}}}}]")
    val r2 = Json.stringify(boot.getResultsByGroupId(resultsRDD, 2))
    r2 must be("[{\"id\":2,\"level\":2,\"results\":{\"n\":350,\"statsDiag\":true,\"d1d2\":{\"mean\":{\"overlaps\":true,\"contains\":true},\"variance\":{\"overlaps\":true,\"contains\":true},\"skewness\":{\"overlaps\":true,\"contains\":true},\"kurtosis\":{\"overlaps\":true,\"contains\":true}},\"d1\":{\"mean\":{\"overlaps\":true,\"contains\":true},\"variance\":{\"overlaps\":true,\"contains\":true},\"skewness\":{\"overlaps\":true,\"contains\":true},\"kurtosis\":{\"overlaps\":true,\"contains\":true}},\"d2\":{\"mean\":{\"overlaps\":true,\"contains\":true},\"variance\":{\"overlaps\":true,\"contains\":true},\"skewness\":{\"overlaps\":true,\"contains\":true},\"kurtosis\":{\"overlaps\":true,\"contains\":true}},\"reg\":{\"pearson\":{\"overlaps\":true,\"contains\":true}}}}]")
    val r3 = Json.stringify(boot.getResultsByGroupId(resultsRDD, 3))
    r3 must be("[{\"id\":3,\"level\":2,\"results\":{\"n\":250,\"statsDiag\":true,\"d1d2\":{\"mean\":{\"overlaps\":true,\"contains\":true},\"variance\":{\"overlaps\":true,\"contains\":true},\"skewness\":{\"overlaps\":true,\"contains\":true},\"kurtosis\":{\"overlaps\":true,\"contains\":true}},\"d1\":{\"mean\":{\"overlaps\":true,\"contains\":true},\"variance\":{\"overlaps\":true,\"contains\":true},\"skewness\":{\"overlaps\":true,\"contains\":true},\"kurtosis\":{\"overlaps\":true,\"contains\":true}},\"d2\":{\"mean\":{\"overlaps\":true,\"contains\":true},\"variance\":{\"overlaps\":true,\"contains\":true},\"skewness\":{\"overlaps\":true,\"contains\":true},\"kurtosis\":{\"overlaps\":true,\"contains\":true}},\"reg\":{\"pearson\":{\"overlaps\":true,\"contains\":true}}}}]")
    val r4 = Json.stringify(boot.getResultsByGroupId(resultsRDD, 4))
    r4 must be("[{\"id\":4,\"level\":1,\"results\":{\"n\":400,\"statsDiag\":true,\"d1d2\":{\"mean\":{\"overlaps\":true,\"contains\":true},\"variance\":{\"overlaps\":true,\"contains\":true},\"skewness\":{\"overlaps\":true,\"contains\":true},\"kurtosis\":{\"overlaps\":true,\"contains\":true}},\"d1\":{\"mean\":{\"overlaps\":true,\"contains\":true},\"variance\":{\"overlaps\":true,\"contains\":true},\"skewness\":{\"overlaps\":true,\"contains\":true},\"kurtosis\":{\"overlaps\":true,\"contains\":true}},\"d2\":{\"mean\":{\"overlaps\":true,\"contains\":true},\"variance\":{\"overlaps\":true,\"contains\":true},\"skewness\":{\"overlaps\":true,\"contains\":true},\"kurtosis\":{\"overlaps\":true,\"contains\":true}},\"reg\":{\"pearson\":{\"overlaps\":true,\"contains\":true}}}}]")
    val r5 = Json.stringify(boot.getResultsByGroupId(resultsRDD, 5))
    r5 must be("[{\"id\":5,\"level\":2,\"results\":{\"n\":180,\"statsDiag\":true,\"d1d2\":{\"mean\":{\"overlaps\":true,\"contains\":true},\"variance\":{\"overlaps\":true,\"contains\":true},\"skewness\":{\"overlaps\":true,\"contains\":true},\"kurtosis\":{\"overlaps\":true,\"contains\":true}},\"d1\":{\"mean\":{\"overlaps\":true,\"contains\":true},\"variance\":{\"overlaps\":true,\"contains\":true},\"skewness\":{\"overlaps\":true,\"contains\":true},\"kurtosis\":{\"overlaps\":true,\"contains\":true}},\"d2\":{\"mean\":{\"overlaps\":true,\"contains\":true},\"variance\":{\"overlaps\":true,\"contains\":true},\"skewness\":{\"overlaps\":true,\"contains\":true},\"kurtosis\":{\"overlaps\":true,\"contains\":true}},\"reg\":{\"pearson\":{\"overlaps\":true,\"contains\":true}}}}]")
    val r6 = Json.stringify(boot.getResultsByGroupId(resultsRDD, 6))
    r6 must be("[{\"id\":6,\"level\":2,\"results\":{\"n\":220,\"statsDiag\":true,\"d1d2\":{\"mean\":{\"overlaps\":true,\"contains\":true},\"variance\":{\"overlaps\":true,\"contains\":true},\"skewness\":{\"overlaps\":true,\"contains\":true},\"kurtosis\":{\"overlaps\":true,\"contains\":true}},\"d1\":{\"mean\":{\"overlaps\":true,\"contains\":true},\"variance\":{\"overlaps\":true,\"contains\":true},\"skewness\":{\"overlaps\":true,\"contains\":true},\"kurtosis\":{\"overlaps\":true,\"contains\":true}},\"d2\":{\"mean\":{\"overlaps\":true,\"contains\":true},\"variance\":{\"overlaps\":true,\"contains\":true},\"skewness\":{\"overlaps\":true,\"contains\":true},\"kurtosis\":{\"overlaps\":true,\"contains\":true}},\"reg\":{\"pearson\":{\"overlaps\":true,\"contains\":true}}}}]")
  }

  test("results by Level are correct") {
    val r1 = boot.getResultsByLevel(resultsRDD, 1)
    Json.stringify(r1) must be("[{\"id\":4,\"level\":1,\"results\":{\"n\":400,\"statsDiag\":true,\"d1d2\":{\"mean\":{\"overlaps\":true,\"contains\":true},\"variance\":{\"overlaps\":true,\"contains\":true},\"skewness\":{\"overlaps\":true,\"contains\":true},\"kurtosis\":{\"overlaps\":true,\"contains\":true}},\"d1\":{\"mean\":{\"overlaps\":true,\"contains\":true},\"variance\":{\"overlaps\":true,\"contains\":true},\"skewness\":{\"overlaps\":true,\"contains\":true},\"kurtosis\":{\"overlaps\":true,\"contains\":true}},\"d2\":{\"mean\":{\"overlaps\":true,\"contains\":true},\"variance\":{\"overlaps\":true,\"contains\":true},\"skewness\":{\"overlaps\":true,\"contains\":true},\"kurtosis\":{\"overlaps\":true,\"contains\":true}},\"reg\":{\"pearson\":{\"overlaps\":true,\"contains\":true}}}},{\"id\":1,\"level\":1,\"results\":{\"n\":600,\"statsDiag\":true,\"d1d2\":{\"mean\":{\"overlaps\":true,\"contains\":true},\"variance\":{\"overlaps\":true,\"contains\":true},\"skewness\":{\"overlaps\":true,\"contains\":true},\"kurtosis\":{\"overlaps\":true,\"contains\":true}},\"d1\":{\"mean\":{\"overlaps\":true,\"contains\":true},\"variance\":{\"overlaps\":true,\"contains\":true},\"skewness\":{\"overlaps\":true,\"contains\":true},\"kurtosis\":{\"overlaps\":true,\"contains\":true}},\"d2\":{\"mean\":{\"overlaps\":true,\"contains\":true},\"variance\":{\"overlaps\":true,\"contains\":true},\"skewness\":{\"overlaps\":true,\"contains\":true},\"kurtosis\":{\"overlaps\":true,\"contains\":true}},\"reg\":{\"pearson\":{\"overlaps\":true,\"contains\":true}}}}]")
  }

  test("frequencies by GroupID are correct") {
    val f0 = Json.stringify(boot.getFrequenciesByGroupId(data, 0))
    f0 must be("[{\"count\":1000,\"d1d2\":[0.038,0.038,0.03,0.041,0.023,0.035,0.026,0.025,0.023,0.017,0.025,0.021,0.02,0.018,0.014,0.024,0.022,0.017,0.015,0.01,0.014,0.015,0.017,0.006,0.013,0.011,0.013,0.016,0.011,0.016,0.008,0.006,0.007,0.009,0.012,0.006,0.01,0.006,0.012,0.006,0.012,0.014,0.009,0.01,0.007,0.009,0.003,0.011,0.006,0.011,0.005,0.009,0.003,0.007,0.004,0.006,0.006,0.01,0.004,0.007,0.003,0.002,0.006,0.005,0.004,0.008,0.006,0.003,0.005,0.004,0.005,0.008,0.003,0.006,0.006,0.003,0.004,0.002,0.011,0.006,0.004,0.005,0.003,0.004,0.004,0.006,0.008,0.007,0.008,0.002],\"d1\":[0.296,0.186,0.132,0.082,0.092,0.061,0.046,0.054,0.051],\"d2\":[0.114,0.118,0.098,0.106,0.087,0.108,0.098,0.097,0.095,0.079]}]")
    val f1 = Json.stringify(boot.getFrequenciesByGroupId(data, 1))
    f1 must be("[{\"count\":600,\"d1d2\":[0.0366666667,0.0266666667,0.03,0.04,0.02,0.0383333333,0.0233333333,0.0183333333,0.0316666667,0.0183333333,0.0216666667,0.0283333333,0.0283333333,0.0216666667,0.015,0.025,0.0233333333,0.0166666667,0.0183333333,0.01,0.01,0.015,0.0116666667,0.005,0.015,0.015,0.005,0.0166666667,0.0116666667,0.0183333333,0.0083333333,0.0083333333,0.01,0.0083333333,0.015,0.005,0.0116666667,0.0066666667,0.0133333333,0.0033333333,0.0083333333,0.01,0.0066666667,0.0116666667,0.01,0.0066666667,0.005,0.0116666667,0.005,0.0083333333,0.005,0.0116666667,0.005,0.005,0.0016666667,0.01,0.005,0.0016666667,0.005,0.0116666667,0.0016666667,0.0016666667,0.005,0.0066666667,0.0033333333,0.0083333333,0.0066666667,0.005,0.0033333333,0.005,0.0083333333,0.0066666667,0.005,0.0066666667,0.005,0.0033333333,0.0033333333,0.0033333333,0.01,0.005,0.0033333333,0.005,0.005,0.0033333333,0.0016666667,0.0083333333,0.005,0.0066666667,0.0066666667,0.0016666667],\"d1\":[0.2833333333,0.2083333333,0.1233333333,0.09,0.0833333333,0.0616666667,0.0466666667,0.0566666667,0.0466666667],\"d2\":[0.1033333333,0.1133333333,0.1066666667,0.1083333333,0.0866666667,0.12,0.0883333333,0.0866666667,0.105,0.0816666667]}]")
    val f2 = Json.stringify(boot.getFrequenciesByGroupId(data, 2))
    f2 must be("[{\"count\":350,\"d1d2\":[0.0314285714,0.0342857143,0.0285714286,0.0371428571,0.0285714286,0.04,0.0342857143,0.0142857143,0.0342857143,0.0142857143,0.02,0.02,0.0257142857,0.0171428571,0.0171428571,0.0257142857,0.0171428571,0.0228571429,0.0171428571,0.0028571429,0.0142857143,0.02,0.0142857143,0,0.0171428571,0.02,0.0057142857,0.0142857143,0.0085714286,0.0085714286,0.0057142857,0.0085714286,0.0085714286,0.0028571429,0.02,0.0028571429,0.0114285714,0.0028571429,0.0114285714,0.0028571429,0.0057142857,0.0085714286,0.0085714286,0.0085714286,0.0085714286,0.0114285714,0.0057142857,0.0114285714,0.0028571429,0.0085714286,0.0057142857,0.0171428571,0.0085714286,0.0028571429,0.0028571429,0.0057142857,0.0057142857,0.0028571429,0.0057142857,0.0114285714,0.0028571429,0,0.0085714286,0.0057142857,0.0057142857,0.0085714286,0.0057142857,0.0057142857,0.0057142857,0.0057142857,0.0114285714,0.0028571429,0.0028571429,0.0085714286,0.0028571429,0,0.0028571429,0.0028571429,0.0085714286,0.0085714286,0.0057142857,0.0057142857,0.0057142857,0.0057142857,0.0028571429,0.0114285714,0.0085714286,0.0028571429,0.0114285714,0.0028571429],\"d1\":[0.2971428571,0.1857142857,0.1228571429,0.0771428571,0.08,0.0685714286,0.0542857143,0.0514285714,0.0628571429],\"d2\":[0.1028571429,0.1171428571,0.1114285714,0.0885714286,0.1057142857,0.1257142857,0.0971428571,0.08,0.1057142857,0.0657142857]}]")
    val f3 = Json.stringify(boot.getFrequenciesByGroupId(data, 3))
    f3 must be("[{\"count\":250,\"d1d2\":[0.044,0.016,0.032,0.044,0.008,0.036,0.008,0.024,0.028,0.024,0.024,0.04,0.032,0.028,0.012,0.024,0.032,0.008,0.02,0.02,0.004,0.008,0.008,0.012,0.012,0.008,0.004,0.02,0.016,0.032,0.012,0.008,0.012,0.016,0.008,0.008,0.012,0.012,0.016,0.004,0.012,0.012,0.004,0.016,0.012,0,0.004,0.012,0.008,0.008,0.004,0.004,0,0.008,0,0.016,0.004,0,0.004,0.012,0,0.004,0,0.008,0,0.008,0.008,0.004,0,0.004,0.004,0.012,0.008,0.004,0.008,0.008,0.004,0.004,0.012,0,0,0.004,0.004,0,0,0.004,0,0.012,0,0],\"d1\":[0.264,0.24,0.124,0.108,0.088,0.052,0.036,0.064,0.024],\"d2\":[0.104,0.108,0.1,0.136,0.06,0.112,0.076,0.096,0.104,0.104]}]")
    val f4 = Json.stringify(boot.getFrequenciesByGroupId(data, 4))
    f4 must be("[{\"count\":400,\"d1d2\":[0.04,0.055,0.03,0.0425,0.0275,0.03,0.03,0.035,0.01,0.015,0.03,0.01,0.0075,0.0125,0.0125,0.0225,0.02,0.0175,0.01,0.01,0.02,0.015,0.025,0.0075,0.01,0.005,0.025,0.015,0.01,0.0125,0.0075,0.0025,0.0025,0.01,0.0075,0.0075,0.0075,0.005,0.01,0.01,0.0175,0.02,0.0125,0.0075,0.0025,0.0125,0,0.01,0.0075,0.015,0.005,0.005,0,0.01,0.0075,0,0.0075,0.0225,0.0025,0,0.005,0.0025,0.0075,0.0025,0.005,0.0075,0.005,0,0.0075,0.0025,0,0.01,0,0.005,0.0075,0.0025,0.005,0,0.0125,0.0075,0.005,0.005,0,0.005,0.0075,0.0025,0.0125,0.0075,0.01,0.0025],\"d1\":[0.315,0.1525,0.145,0.07,0.105,0.06,0.045,0.05,0.0575],\"d2\":[0.13,0.125,0.085,0.1025,0.0875,0.09,0.1125,0.1125,0.08,0.075]}]")
    val f5 = Json.stringify(boot.getFrequenciesByGroupId(data, 5))
    f5 must be("[{\"count\":180,\"d1d2\":[0.0166666667,0.0555555556,0.0222222222,0.0555555556,0.0333333333,0.0333333333,0.0277777778,0.0277777778,0,0.0111111111,0.0166666667,0.0166666667,0,0.0166666667,0.0111111111,0.0277777778,0.0222222222,0.0166666667,0.0166666667,0.0055555556,0.0222222222,0.0277777778,0.0277777778,0,0.0166666667,0,0.0222222222,0.0222222222,0.0111111111,0.0166666667,0.0055555556,0,0.0055555556,0,0.0166666667,0.0111111111,0.0111111111,0,0.0111111111,0.0111111111,0.0166666667,0.0166666667,0.0111111111,0.0166666667,0,0.0166666667,0,0.0166666667,0.0111111111,0.0111111111,0,0,0,0.0166666667,0.0111111111,0,0.0111111111,0.0111111111,0,0,0.0055555556,0,0.0111111111,0.0055555556,0.0111111111,0.0055555556,0,0,0.0111111111,0,0,0.0055555556,0,0,0.0111111111,0,0.0055555556,0,0.0111111111,0,0,0.0111111111,0,0.0055555556,0.0111111111,0.0055555556,0.0111111111,0.0111111111,0.0166666667,0.0055555556],\"d1\":[0.2833333333,0.15,0.1666666667,0.0722222222,0.1166666667,0.05,0.05,0.0333333333,0.0777777778],\"d2\":[0.0833333333,0.1333333333,0.0777777778,0.1166666667,0.1222222222,0.1,0.1111111111,0.1055555556,0.0888888889,0.0611111111]}]")
    val f6 = Json.stringify(boot.getFrequenciesByGroupId(data, 6))
    f6 must be("[{\"count\":220,\"d1d2\":[0.0590909091,0.0545454545,0.0363636364,0.0318181818,0.0227272727,0.0272727273,0.0318181818,0.0409090909,0.0181818182,0.0181818182,0.0409090909,0.0045454545,0.0136363636,0.0090909091,0.0136363636,0.0181818182,0.0181818182,0.0181818182,0.0045454545,0.0136363636,0.0181818182,0.0045454545,0.0227272727,0.0136363636,0.0045454545,0.0090909091,0.0272727273,0.0090909091,0.0090909091,0.0090909091,0.0090909091,0.0045454545,0,0.0181818182,0,0.0045454545,0.0045454545,0.0090909091,0.0090909091,0.0090909091,0.0181818182,0.0227272727,0.0136363636,0,0.0045454545,0.0090909091,0,0.0045454545,0.0045454545,0.0181818182,0.0090909091,0.0090909091,0,0.0045454545,0.0045454545,0,0.0045454545,0.0318181818,0.0045454545,0,0.0045454545,0.0045454545,0.0045454545,0,0,0.0090909091,0.0090909091,0,0.0045454545,0.0045454545,0,0.0136363636,0,0.0090909091,0.0045454545,0.0045454545,0.0045454545,0,0.0136363636,0.0136363636,0.0090909091,0,0,0.0045454545,0.0045454545,0,0.0136363636,0.0045454545,0.0045454545,0],\"d1\":[0.3409090909,0.1545454545,0.1272727273,0.0681818182,0.0954545455,0.0681818182,0.0409090909,0.0636363636,0.0409090909],\"d2\":[0.1681818182,0.1181818182,0.0909090909,0.0909090909,0.0590909091,0.0818181818,0.1136363636,0.1181818182,0.0727272727,0.0863636364]}]")
  }

  test("frequencies by Level are correct") {
    val f1 = boot.getFrequenciesByLevel(data, 1)
    Json.stringify(f1) must be("[{\"count\":400,\"d1d2\":[0.04,0.055,0.03,0.0425,0.0275,0.03,0.03,0.035,0.01,0.015,0.03,0.01,0.0075,0.0125,0.0125,0.0225,0.02,0.0175,0.01,0.01,0.02,0.015,0.025,0.0075,0.01,0.005,0.025,0.015,0.01,0.0125,0.0075,0.0025,0.0025,0.01,0.0075,0.0075,0.0075,0.005,0.01,0.01,0.0175,0.02,0.0125,0.0075,0.0025,0.0125,0,0.01,0.0075,0.015,0.005,0.005,0,0.01,0.0075,0,0.0075,0.0225,0.0025,0,0.005,0.0025,0.0075,0.0025,0.005,0.0075,0.005,0,0.0075,0.0025,0,0.01,0,0.005,0.0075,0.0025,0.005,0,0.0125,0.0075,0.005,0.005,0,0.005,0.0075,0.0025,0.0125,0.0075,0.01,0.0025],\"d1\":[0.315,0.1525,0.145,0.07,0.105,0.06,0.045,0.05,0.0575],\"d2\":[0.13,0.125,0.085,0.1025,0.0875,0.09,0.1125,0.1125,0.08,0.075]},{\"count\":600,\"d1d2\":[0.0366666667,0.0266666667,0.03,0.04,0.02,0.0383333333,0.0233333333,0.0183333333,0.0316666667,0.0183333333,0.0216666667,0.0283333333,0.0283333333,0.0216666667,0.015,0.025,0.0233333333,0.0166666667,0.0183333333,0.01,0.01,0.015,0.0116666667,0.005,0.015,0.015,0.005,0.0166666667,0.0116666667,0.0183333333,0.0083333333,0.0083333333,0.01,0.0083333333,0.015,0.005,0.0116666667,0.0066666667,0.0133333333,0.0033333333,0.0083333333,0.01,0.0066666667,0.0116666667,0.01,0.0066666667,0.005,0.0116666667,0.005,0.0083333333,0.005,0.0116666667,0.005,0.005,0.0016666667,0.01,0.005,0.0016666667,0.005,0.0116666667,0.0016666667,0.0016666667,0.005,0.0066666667,0.0033333333,0.0083333333,0.0066666667,0.005,0.0033333333,0.005,0.0083333333,0.0066666667,0.005,0.0066666667,0.005,0.0033333333,0.0033333333,0.0033333333,0.01,0.005,0.0033333333,0.005,0.005,0.0033333333,0.0016666667,0.0083333333,0.005,0.0066666667,0.0066666667,0.0016666667],\"d1\":[0.2833333333,0.2083333333,0.1233333333,0.09,0.0833333333,0.0616666667,0.0466666667,0.0566666667,0.0466666667],\"d2\":[0.1033333333,0.1133333333,0.1066666667,0.1083333333,0.0866666667,0.12,0.0883333333,0.0866666667,0.105,0.0816666667]}]")
  }

  test("Benford CIs by Group ID are correct") {
    val CI0 = Json.stringify(boot.getCIsByGroupId(benfordRDD, 0))
    CI0 must be("[{\"id\":0,\"level\":0,\"CIs\":{\"d1d2\":{\"n\":1000,\"mean\":[{\"alpha\":0.975,\"li\":9.257154165,\"ui\":984.2793289502,\"lower\":36.4619828678,\"upper\":40.300289798,\"t0\":38.568},{\"alpha\":0.99,\"li\":3.5806536732,\"ui\":994.0836962877,\"lower\":36.277338659,\"upper\":40.7361014665,\"t0\":38.568}],\"variance\":[{\"alpha\":0.975,\"li\":87.6689403718,\"ui\":1000,\"lower\":590.1476321799,\"upper\":696.638775,\"t0\":632.625376},{\"alpha\":0.99,\"li\":46.6102664046,\"ui\":1000,\"lower\":579.5207091897,\"upper\":696.638775,\"t0\":632.625376}],\"skewness\":[{\"alpha\":0.975,\"li\":339.8279455579,\"ui\":1000,\"lower\":0.7465573026,\"upper\":0.9618853372,\"t0\":0.8168660437},{\"alpha\":0.99,\"li\":234.3574352269,\"ui\":1000,\"lower\":0.7315773784,\"upper\":0.9618853372,\"t0\":0.8168660437}],\"kurtosis\":[{\"alpha\":0.975,\"li\":287.3303358936,\"ui\":1000,\"lower\":-0.6131057199,\"upper\":-0.1035708789,\"t0\":-0.4630422773},{\"alpha\":0.99,\"li\":198.6915045397,\"ui\":1000,\"lower\":-0.6412036457,\"upper\":-0.1035708789,\"t0\":-0.4630422773}]},\"d1\":{\"n\":1000,\"mean\":[{\"alpha\":0.975,\"li\":4.840996567,\"ui\":972.1927927083,\"lower\":3.215,\"upper\":3.589,\"t0\":3.431},{\"alpha\":0.99,\"li\":1.7196415756,\"ui\":988.114432635,\"lower\":3.200653331,\"upper\":3.617,\"t0\":3.431}],\"variance\":[{\"alpha\":0.975,\"li\":36.4882926239,\"ui\":997.54240447,\"lower\":5.6298982774,\"upper\":6.7478122844,\"t0\":6.105239},{\"alpha\":0.99,\"li\":17.042493852,\"ui\":999.8397042828,\"lower\":5.5442510172,\"upper\":6.7591677866,\"t0\":6.105239}],\"skewness\":[{\"alpha\":0.975,\"li\":299.4104801048,\"ui\":1000,\"lower\":0.763694349,\"upper\":0.9849289745,\"t0\":0.8383566405},{\"alpha\":0.99,\"li\":201.2891124084,\"ui\":1000,\"lower\":0.7490683807,\"upper\":0.9849289745,\"t0\":0.8383566405}],\"kurtosis\":[{\"alpha\":0.975,\"li\":266.2159988,\"ui\":1000,\"lower\":-0.6226319204,\"upper\":-0.0841051298,\"t0\":-0.4674906641},{\"alpha\":0.99,\"li\":181.8009831306,\"ui\":1000,\"lower\":-0.6538210132,\"upper\":-0.0841051298,\"t0\":-0.4674906641}]},\"d2\":{\"n\":1000,\"mean\":[{\"alpha\":0.975,\"li\":248.0490248616,\"ui\":1000,\"lower\":4.1270490749,\"upper\":4.451,\"t0\":4.258},{\"alpha\":0.99,\"li\":150.1513935579,\"ui\":1000,\"lower\":4.097,\"upper\":4.451,\"t0\":4.258}],\"variance\":[{\"alpha\":0.975,\"li\":2.7953367423,\"ui\":955.8742581089,\"lower\":7.6477254168,\"upper\":8.6541390938,\"t0\":8.185436},{\"alpha\":0.99,\"li\":1,\"ui\":980.2671879936,\"lower\":7.568999,\"upper\":8.7460054995,\"t0\":8.185436}],\"skewness\":[{\"alpha\":0.975,\"li\":1,\"ui\":382.8583018655,\"lower\":-0.0134958792,\"upper\":0.1183734213,\"t0\":0.0743550775},{\"alpha\":0.99,\"li\":1,\"ui\":518.3681649054,\"lower\":-0.0134958792,\"upper\":0.1322252571,\"t0\":0.0743550775}],\"kurtosis\":[{\"alpha\":0.975,\"li\":1,\"ui\":847.6080594733,\"lower\":-1.3209944251,\"upper\":-1.1643797774,\"t0\":-1.2302835043},{\"alpha\":0.99,\"li\":1,\"ui\":917.1643898576,\"lower\":-1.3209944251,\"upper\":-1.1494657784,\"t0\":-1.2302835043}]},\"r\":{\"n\":1000,\"pearson\":[{\"alpha\":0.975,\"li\":635.6281472492,\"ui\":1000,\"lower\":0.0685750213,\"upper\":0.1534862004,\"t0\":0.0984268144},{\"alpha\":0.99,\"li\":501.0061509132,\"ui\":1000,\"lower\":0.0560742091,\"upper\":0.1534862004,\"t0\":0.0984268144}],\"alpha0\":[{\"alpha\":0.975,\"li\":1,\"ui\":376.1585509636,\"lower\":2.8467221229,\"upper\":3.1940995337,\"t0\":3.0690492235},{\"alpha\":0.99,\"li\":1,\"ui\":513.1494273846,\"lower\":2.8467221229,\"upper\":3.2403336188,\"t0\":3.0690492235}],\"alpha1\":[{\"alpha\":0.975,\"li\":658.8199925829,\"ui\":1000,\"lower\":0.0604371408,\"upper\":0.1363161873,\"t0\":0.0850048794},{\"alpha\":0.99,\"li\":526.7754038771,\"ui\":1000,\"lower\":0.0498254069,\"upper\":0.1363161873,\"t0\":0.0850048794}],\"beta0\":[{\"alpha\":0.975,\"li\":1,\"ui\":867.9244448933,\"lower\":3.493958416,\"upper\":4.1359187533,\"t0\":3.8669757236},{\"alpha\":0.99,\"li\":1,\"ui\":927.065979392,\"lower\":3.493958416,\"upper\":4.1860887063,\"t0\":3.8669757236}],\"beta1\":[{\"alpha\":0.975,\"li\":626.7265747916,\"ui\":1000,\"lower\":0.0790984135,\"upper\":0.1728189013,\"t0\":0.1139680199},{\"alpha\":0.99,\"li\":491.5046754078,\"ui\":1000,\"lower\":0.0648262251,\"upper\":0.1728189013,\"t0\":0.1139680199}]}}}]")
    val CI1 = Json.stringify(boot.getCIsByGroupId(benfordRDD, 1))
    CI1 must be("[{\"id\":1,\"level\":1,\"CIs\":{\"d1d2\":{\"n\":600,\"mean\":[{\"alpha\":0.975,\"li\":2.7449858386,\"ui\":962.2961310085,\"lower\":35.6896292624,\"upper\":40.4019595458,\"t0\":38.4766666667},{\"alpha\":0.99,\"li\":1,\"ui\":981.4917207356,\"lower\":35.0216666667,\"upper\":40.735,\"t0\":38.4766666667}],\"variance\":[{\"alpha\":0.975,\"li\":3.0724409636,\"ui\":963.2198569971,\"lower\":530.493468463,\"upper\":677.3701445467,\"t0\":615.9761222222},{\"alpha\":0.99,\"li\":1,\"ui\":982.6404468596,\"lower\":490.3311972222,\"upper\":692.1990218957,\"t0\":615.9761222222}],\"skewness\":[{\"alpha\":0.975,\"li\":361.4898862352,\"ui\":1000,\"lower\":0.7405036863,\"upper\":1.0311220714,\"t0\":0.8314262616},{\"alpha\":0.99,\"li\":255.0744186682,\"ui\":1000,\"lower\":0.7201052201,\"upper\":1.0311220714,\"t0\":0.8314262616}],\"kurtosis\":[{\"alpha\":0.975,\"li\":259.7492198658,\"ui\":1000,\"lower\":-0.6501038256,\"upper\":0.0206682774,\"t0\":-0.444126526},{\"alpha\":0.99,\"li\":182.2472090508,\"ui\":1000,\"lower\":-0.683253493,\"upper\":0.0206682774,\"t0\":-0.444126526}]},\"d1\":{\"n\":600,\"mean\":[{\"alpha\":0.975,\"li\":1.0220663331,\"ui\":934.4556999945,\"lower\":3.099659082,\"upper\":3.5874237611,\"t0\":3.4166666667},{\"alpha\":0.99,\"li\":1,\"ui\":965.0212590135,\"lower\":3.0983333333,\"upper\":3.6233333333,\"t0\":3.4166666667}],\"variance\":[{\"alpha\":0.975,\"li\":2.4941035922,\"ui\":958.0296410638,\"lower\":5.1190266419,\"upper\":6.583475444,\"t0\":5.9897222222},{\"alpha\":0.99,\"li\":1,\"ui\":979.6958063657,\"lower\":4.8186638889,\"upper\":6.7179749308,\"t0\":5.9897222222}],\"skewness\":[{\"alpha\":0.975,\"li\":390.0164245005,\"ui\":1000,\"lower\":0.7692711402,\"upper\":1.0554384327,\"t0\":0.8552433321},{\"alpha\":0.99,\"li\":281.11096723,\"ui\":1000,\"lower\":0.7469629946,\"upper\":1.0554384327,\"t0\":0.8552433321}],\"kurtosis\":[{\"alpha\":0.975,\"li\":290.9330201538,\"ui\":1000,\"lower\":-0.6447245458,\"upper\":0.0810984483,\"t0\":-0.4401653371},{\"alpha\":0.99,\"li\":208.7689029554,\"ui\":1000,\"lower\":-0.6730043602,\"upper\":0.0810984483,\"t0\":-0.4401653371}]},\"d2\":{\"n\":600,\"mean\":[{\"alpha\":0.975,\"li\":477.4580915111,\"ui\":1000,\"lower\":4.18,\"upper\":4.5183333333,\"t0\":4.31},{\"alpha\":0.99,\"li\":342.158936731,\"ui\":1000,\"lower\":4.145,\"upper\":4.5183333333,\"t0\":4.31}],\"variance\":[{\"alpha\":0.975,\"li\":1,\"ui\":874.5502229873,\"lower\":7.4822666667,\"upper\":8.5957249974,\"t0\":8.0872333333},{\"alpha\":0.99,\"li\":1,\"ui\":933.9098077183,\"lower\":7.4822666667,\"upper\":8.72154912,\"t0\":8.0872333333}],\"skewness\":[{\"alpha\":0.975,\"li\":1,\"ui\":736.2795672908,\"lower\":-0.0501537476,\"upper\":0.1680564246,\"t0\":0.0830088931},{\"alpha\":0.99,\"li\":1,\"ui\":838.1430335791,\"lower\":-0.0501537476,\"upper\":0.190168033,\"t0\":0.0830088931}],\"kurtosis\":[{\"alpha\":0.975,\"li\":7.7718141518,\"ui\":980.4964913981,\"lower\":-1.3219516076,\"upper\":-1.0981054148,\"t0\":-1.2128782358},{\"alpha\":0.99,\"li\":3.2826904473,\"ui\":993.1355577606,\"lower\":-1.3419525892,\"upper\":-1.0738777736,\"t0\":-1.2128782358}]},\"r\":{\"n\":600,\"pearson\":[{\"alpha\":0.975,\"li\":27.4682189029,\"ui\":995.8535155273,\"lower\":-0.0192248871,\"upper\":0.1590227257,\"t0\":0.0640573854},{\"alpha\":0.99,\"li\":12.2063817199,\"ui\":999.1583767121,\"lower\":-0.0302573005,\"upper\":0.1646797703,\"t0\":0.0640573854}]}}}]")
    val CI2 = Json.stringify(boot.getCIsByGroupId(benfordRDD, 2))
    CI2 must be("[{\"id\":2,\"level\":2,\"CIs\":{\"d1d2\":{\"n\":350,\"mean\":[{\"alpha\":0.975,\"li\":158.5852060844,\"ui\":1000,\"lower\":37.3902448809,\"upper\":42.8657142857,\"t0\":39.38},{\"alpha\":0.99,\"li\":90.260911677,\"ui\":1000,\"lower\":36.8789058318,\"upper\":42.8657142857,\"t0\":39.38}],\"variance\":[{\"alpha\":0.975,\"li\":637.6987599048,\"ui\":1000,\"lower\":634.9825830543,\"upper\":747.8189714286,\"t0\":672.0013142857},{\"alpha\":0.99,\"li\":501.0489031694,\"ui\":1000,\"lower\":621.9256146559,\"upper\":747.8189714286,\"t0\":672.0013142857}],\"skewness\":[{\"alpha\":0.975,\"li\":38.897782088,\"ui\":998.0254776716,\"lower\":0.6193799762,\"upper\":1.0134429703,\"t0\":0.7842915914},{\"alpha\":0.99,\"li\":18.8663583472,\"ui\":1000,\"lower\":0.5908435345,\"upper\":1.0804991838,\"t0\":0.7842915914}],\"kurtosis\":[{\"alpha\":0.975,\"li\":7.7941457698,\"ui\":978.3266827354,\"lower\":-0.9389946832,\"upper\":-0.1612464364,\"t0\":-0.6097881532},{\"alpha\":0.99,\"li\":3.9304285745,\"ui\":994.0307980012,\"lower\":-0.9852912713,\"upper\":-0.0465251887,\"t0\":-0.6097881532}]},\"d1\":{\"n\":350,\"mean\":[{\"alpha\":0.975,\"li\":134.5556305044,\"ui\":1000,\"lower\":3.3085714286,\"upper\":3.8514285714,\"t0\":3.5142857143},{\"alpha\":0.99,\"li\":74.2210416195,\"ui\":1000,\"lower\":3.2520626456,\"upper\":3.8514285714,\"t0\":3.5142857143}],\"variance\":[{\"alpha\":0.975,\"li\":624.0942318613,\"ui\":1000,\"lower\":6.1718278572,\"upper\":7.3037061224,\"t0\":6.5412244898},{\"alpha\":0.99,\"li\":486.4003366808,\"ui\":1000,\"lower\":6.0257128005,\"upper\":7.3037061224,\"t0\":6.5412244898}],\"skewness\":[{\"alpha\":0.975,\"li\":16.7002954371,\"ui\":991.9492219407,\"lower\":0.6099714393,\"upper\":1.0014654731,\"t0\":0.7924531207},{\"alpha\":0.99,\"li\":7.4086880556,\"ui\":997.7991255134,\"lower\":0.5830114766,\"upper\":1.0303255112,\"t0\":0.7924531207}],\"kurtosis\":[{\"alpha\":0.975,\"li\":5.0059662059,\"ui\":964.506672845,\"lower\":-0.9688574426,\"upper\":-0.1782717652,\"t0\":-0.624752},{\"alpha\":0.99,\"li\":2.4451565869,\"ui\":988.4904721207,\"lower\":-1.0065566009,\"upper\":-0.0894514264,\"t0\":-0.624752}]},\"d2\":{\"n\":350,\"mean\":[{\"alpha\":0.975,\"li\":30.8637959031,\"ui\":995.7044768637,\"lower\":3.9114285714,\"upper\":4.5553555611,\"t0\":4.2371428571},{\"alpha\":0.99,\"li\":11.7713976585,\"ui\":998.6843001259,\"lower\":3.8215883507,\"upper\":4.5730625095,\"t0\":4.2371428571}],\"variance\":[{\"alpha\":0.975,\"li\":1,\"ui\":422.0226548045,\"lower\":6.9732979592,\"upper\":8.1695032636,\"t0\":7.7466204082},{\"alpha\":0.99,\"li\":1,\"ui\":555.8757547696,\"lower\":6.9732979592,\"upper\":8.2840816327,\"t0\":7.7466204082}],\"skewness\":[{\"alpha\":0.975,\"li\":1,\"ui\":887.6049172563,\"lower\":-0.0789122472,\"upper\":0.2267290942,\"t0\":0.0831427871},{\"alpha\":0.99,\"li\":1,\"ui\":945.1700406228,\"lower\":-0.0789122472,\"upper\":0.2650095404,\"t0\":0.0831427871}],\"kurtosis\":[{\"alpha\":0.975,\"li\":111.2824901234,\"ui\":1000,\"lower\":-1.2800367945,\"upper\":-0.9033469427,\"t0\":-1.1725045208},{\"alpha\":0.99,\"li\":67.0869453775,\"ui\":1000,\"lower\":-1.2973089395,\"upper\":-0.9033469427,\"t0\":-1.1725045208}]},\"r\":{\"n\":350,\"pearson\":[{\"alpha\":0.975,\"li\":31.2868681076,\"ui\":996.5506715718,\"lower\":-0.0447539035,\"upper\":0.1926077941,\"t0\":0.0711688614},{\"alpha\":0.99,\"li\":13.8990227103,\"ui\":999.3925594469,\"lower\":-0.0624737404,\"upper\":0.2152322209,\"t0\":0.0711688614}]}}}]")
    val CI3 = Json.stringify(boot.getCIsByGroupId(benfordRDD, 3))
    CI3 must be("[{\"id\":3,\"level\":2,\"CIs\":{\"d1d2\":{\"n\":250,\"mean\":[{\"alpha\":0.975,\"li\":1,\"ui\":647.2780118786,\"lower\":33.7,\"upper\":39.3211116411,\"t0\":37.212},{\"alpha\":0.99,\"li\":1,\"ui\":758.7445360655,\"lower\":33.7,\"upper\":39.848,\"t0\":37.212}],\"variance\":[{\"alpha\":0.975,\"li\":1,\"ui\":108.2463351608,\"lower\":434.274176,\"upper\":560.2109019078,\"t0\":534.799056},{\"alpha\":0.99,\"li\":1,\"ui\":183.9324837535,\"lower\":434.274176,\"upper\":573.44615705,\"t0\":534.799056}],\"skewness\":[{\"alpha\":0.975,\"li\":442.4797417896,\"ui\":1000,\"lower\":0.7495428876,\"upper\":1.1245603095,\"t0\":0.8779799909},{\"alpha\":0.99,\"li\":329.8083133481,\"ui\":1000,\"lower\":0.7149588406,\"upper\":1.1245603095,\"t0\":0.8779799909}],\"kurtosis\":[{\"alpha\":0.975,\"li\":613.7981239638,\"ui\":1000,\"lower\":-0.5027755404,\"upper\":0.2388163194,\"t0\":-0.2295633073},{\"alpha\":0.99,\"li\":509.1879183407,\"ui\":1000,\"lower\":-0.5594168719,\"upper\":0.2388163194,\"t0\":-0.2295633073}]},\"d1\":{\"n\":250,\"mean\":[{\"alpha\":0.975,\"li\":1,\"ui\":545.6916582391,\"lower\":2.96,\"upper\":3.468,\"t0\":3.28},{\"alpha\":0.99,\"li\":1,\"ui\":668.8228544423,\"lower\":2.96,\"upper\":3.52,\"t0\":3.28}],\"variance\":[{\"alpha\":0.975,\"li\":1,\"ui\":75.6944138662,\"lower\":4.257104,\"upper\":5.3466206739,\"t0\":5.1856},{\"alpha\":0.99,\"li\":1,\"ui\":135.7776151698,\"lower\":4.257104,\"upper\":5.5079539533,\"t0\":5.1856}],\"skewness\":[{\"alpha\":0.975,\"li\":587.9709131729,\"ui\":1000,\"lower\":0.8096817381,\"upper\":1.1932501533,\"t0\":0.9293346587},{\"alpha\":0.99,\"li\":469.9243061329,\"ui\":1000,\"lower\":0.7773798015,\"upper\":1.1932501533,\"t0\":0.9293346587}],\"kurtosis\":[{\"alpha\":0.975,\"li\":703.7447970848,\"ui\":1000,\"lower\":-0.4343082653,\"upper\":0.400168433,\"t0\":-0.1820659989},{\"alpha\":0.99,\"li\":605.2516147627,\"ui\":1000,\"lower\":-0.5096275105,\"upper\":0.400168433,\"t0\":-0.1820659989}]},\"d2\":{\"n\":250,\"mean\":[{\"alpha\":0.975,\"li\":548.9604923151,\"ui\":1000,\"lower\":4.2038419461,\"upper\":4.72,\"t0\":4.412},{\"alpha\":0.99,\"li\":419.8412593598,\"ui\":1000,\"lower\":4.14,\"upper\":4.72,\"t0\":4.412}],\"variance\":[{\"alpha\":0.975,\"li\":144.9681151042,\"ui\":1000,\"lower\":7.7439181847,\"upper\":9.836544,\"t0\":8.546256},{\"alpha\":0.99,\"li\":82.1742204508,\"ui\":1000,\"lower\":7.5815903068,\"upper\":9.836544,\"t0\":8.546256}],\"skewness\":[{\"alpha\":0.975,\"li\":1,\"ui\":803.5434732038,\"lower\":-0.1448440808,\"upper\":0.214663659,\"t0\":0.0731222049},{\"alpha\":0.99,\"li\":1,\"ui\":878.6748171469,\"lower\":-0.1448440808,\"upper\":0.2396933588,\"t0\":0.0731222049}],\"kurtosis\":[{\"alpha\":0.975,\"li\":1,\"ui\":669.343318867,\"lower\":-1.4322113637,\"upper\":-1.1656286901,\"t0\":-1.2736169607},{\"alpha\":0.99,\"li\":1,\"ui\":795.8608370792,\"lower\":-1.4322113637,\"upper\":-1.1378732666,\"t0\":-1.2736169607}]},\"r\":{\"n\":250,\"pearson\":[{\"alpha\":0.975,\"li\":13.013038947,\"ui\":988.9607514775,\"lower\":-0.0790458108,\"upper\":0.1941824919,\"t0\":0.0577785968},{\"alpha\":0.99,\"li\":5.1082562911,\"ui\":996.0938409796,\"lower\":-0.1170555073,\"upper\":0.2141890452,\"t0\":0.0577785968}]}}}]")
    val CI4 = Json.stringify(boot.getCIsByGroupId(benfordRDD, 4))
    CI4 must be("[{\"id\":4,\"level\":1,\"CIs\":{\"d1d2\":{\"n\":400,\"mean\":[{\"alpha\":0.975,\"li\":23.0149256044,\"ui\":994.7820505621,\"lower\":36.1401139422,\"upper\":41.6021263517,\"t0\":38.705},{\"alpha\":0.99,\"li\":10.3612086515,\"ui\":998.8379626371,\"lower\":35.7052815146,\"upper\":42.4777131592,\"t0\":38.705}],\"variance\":[{\"alpha\":0.975,\"li\":339.058885733,\"ui\":1000,\"lower\":606.4803654054,\"upper\":754.6114,\"t0\":657.567975},{\"alpha\":0.99,\"li\":229.682472643,\"ui\":1000,\"lower\":593.8206047973,\"upper\":754.6114,\"t0\":657.567975}],\"skewness\":[{\"alpha\":0.975,\"li\":55.8082032789,\"ui\":999.2900084032,\"lower\":0.6426469256,\"upper\":1.0233172063,\"t0\":0.795359968},{\"alpha\":0.99,\"li\":28.123386381,\"ui\":1000,\"lower\":0.6158664303,\"upper\":1.0378126701,\"t0\":0.795359968}],\"kurtosis\":[{\"alpha\":0.975,\"li\":98.7690547018,\"ui\":1000,\"lower\":-0.7611399178,\"upper\":0.1626256694,\"t0\":-0.4949639003},{\"alpha\":0.99,\"li\":60.2555393933,\"ui\":1000,\"lower\":-0.791685984,\"upper\":0.1626256694,\"t0\":-0.4949639003}]},\"d1\":{\"n\":400,\"mean\":[{\"alpha\":0.975,\"li\":22.9010250213,\"ui\":994.802158144,\"lower\":3.195,\"upper\":3.7444775399,\"t0\":3.4525},{\"alpha\":0.99,\"li\":10.4181249868,\"ui\":998.8811125914,\"lower\":3.1603534428,\"upper\":3.8229959006,\"t0\":3.4525}],\"variance\":[{\"alpha\":0.975,\"li\":173.0755028262,\"ui\":1000,\"lower\":5.7178506311,\"upper\":7.13399375,\"t0\":6.27774375},{\"alpha\":0.99,\"li\":101.8444965509,\"ui\":1000,\"lower\":5.5964959402,\"upper\":7.13399375,\"t0\":6.27774375}],\"skewness\":[{\"alpha\":0.975,\"li\":46.8122143692,\"ui\":998.7272119181,\"lower\":0.6643005775,\"upper\":1.0348774853,\"t0\":0.8133183961},{\"alpha\":0.99,\"li\":23.0746018632,\"ui\":1000,\"lower\":0.6354248443,\"upper\":1.0399959201,\"t0\":0.8133183961}],\"kurtosis\":[{\"alpha\":0.975,\"li\":73.8879847106,\"ui\":1000,\"lower\":-0.7856901954,\"upper\":0.1108406376,\"t0\":-0.5086785567},{\"alpha\":0.99,\"li\":44.2816684715,\"ui\":1000,\"lower\":-0.8241238841,\"upper\":0.1108406376,\"t0\":-0.5086785567}]},\"d2\":{\"n\":400,\"mean\":[{\"alpha\":0.975,\"li\":10.1750994387,\"ui\":985.4900674237,\"lower\":3.8638591222,\"upper\":4.5112078728,\"t0\":4.18},{\"alpha\":0.99,\"li\":4.2563000936,\"ui\":995.0576449739,\"lower\":3.8270695466,\"upper\":4.545801954,\"t0\":4.18}],\"variance\":[{\"alpha\":0.975,\"li\":58.7335378387,\"ui\":999.5250726162,\"lower\":7.6608585698,\"upper\":9.4408497978,\"t0\":8.3226},{\"alpha\":0.99,\"li\":30.3071689184,\"ui\":1000,\"lower\":7.5550649077,\"upper\":9.47224375,\"t0\":8.3226}],\"skewness\":[{\"alpha\":0.975,\"li\":1,\"ui\":651.3270885891,\"lower\":-0.1278475388,\"upper\":0.1638533036,\"t0\":0.0643472263},{\"alpha\":0.99,\"li\":1,\"ui\":761.4046568487,\"lower\":-0.1278475388,\"upper\":0.185177447,\"t0\":0.0643472263}],\"kurtosis\":[{\"alpha\":0.975,\"li\":1,\"ui\":589.9497126408,\"lower\":-1.3838953967,\"upper\":-1.1908412209,\"t0\":-1.2604129665},{\"alpha\":0.99,\"li\":1,\"ui\":727.7599517532,\"lower\":-1.3838953967,\"upper\":-1.1654938818,\"t0\":-1.2604129665}]},\"r\":{\"n\":400,\"pearson\":[{\"alpha\":0.975,\"li\":928.9693002026,\"ui\":1000,\"lower\":0.1275337027,\"upper\":0.2356556097,\"t0\":0.148522063},{\"alpha\":0.99,\"li\":870.1463486092,\"ui\":1000,\"lower\":0.1152001107,\"upper\":0.2356556097,\"t0\":0.148522063}]}}}]")
    val CI5 = Json.stringify(boot.getCIsByGroupId(benfordRDD, 5))
    CI5 must be("[{\"id\":5,\"level\":2,\"CIs\":{\"d1d2\":{\"n\":180,\"mean\":[{\"alpha\":0.975,\"li\":220.932156879,\"ui\":1000,\"lower\":37.2166666667,\"upper\":46.5833333333,\"t0\":40.0166666667},{\"alpha\":0.99,\"li\":136.3306585593,\"ui\":1000,\"lower\":36.7129511869,\"upper\":46.5833333333,\"t0\":40.0166666667}],\"variance\":[{\"alpha\":0.975,\"li\":278.1137180636,\"ui\":1000,\"lower\":589.9270813491,\"upper\":814.7739506173,\"t0\":666.9830555556},{\"alpha\":0.99,\"li\":180.4978478905,\"ui\":1000,\"lower\":573.5140525862,\"upper\":814.7739506173,\"t0\":666.9830555556}],\"skewness\":[{\"alpha\":0.975,\"li\":43.6783387095,\"ui\":998.686928969,\"lower\":0.5525822247,\"upper\":1.1591637228,\"t0\":0.7907282465},{\"alpha\":0.99,\"li\":22.1073972909,\"ui\":1000,\"lower\":0.5182863065,\"upper\":1.1982589678,\"t0\":0.7907282465}],\"kurtosis\":[{\"alpha\":0.975,\"li\":125.8568566068,\"ui\":1000,\"lower\":-0.8509661548,\"upper\":0.6579659317,\"t0\":-0.4471283195},{\"alpha\":0.99,\"li\":84.3344583473,\"ui\":1000,\"lower\":-0.8898722733,\"upper\":0.6579659317,\"t0\":-0.4471283195}]},\"d1\":{\"n\":180,\"mean\":[{\"alpha\":0.975,\"li\":199.8456010529,\"ui\":1000,\"lower\":3.2888888889,\"upper\":4.2222222222,\"t0\":3.5722222222},{\"alpha\":0.99,\"li\":122.5467293834,\"ui\":1000,\"lower\":3.2388888889,\"upper\":4.2222222222,\"t0\":3.5722222222}],\"variance\":[{\"alpha\":0.975,\"li\":167.6729828856,\"ui\":1000,\"lower\":5.576191992,\"upper\":7.9808333333,\"t0\":6.378117284},{\"alpha\":0.99,\"li\":98.8279690174,\"ui\":1000,\"lower\":5.4045139928,\"upper\":7.9808333333,\"t0\":6.378117284}],\"skewness\":[{\"alpha\":0.975,\"li\":32.9484269432,\"ui\":997.307938675,\"lower\":0.5502795451,\"upper\":1.1690242937,\"t0\":0.8051385927},{\"alpha\":0.99,\"li\":15.91226151,\"ui\":999.8517172825,\"lower\":0.5246623704,\"upper\":1.2258901475,\"t0\":0.8051385927}],\"kurtosis\":[{\"alpha\":0.975,\"li\":102.4243088622,\"ui\":1000,\"lower\":-0.8744427905,\"upper\":0.6671818279,\"t0\":-0.4734035738},{\"alpha\":0.99,\"li\":67.2864542161,\"ui\":1000,\"lower\":-0.9152757458,\"upper\":0.6671818279,\"t0\":-0.4734035738}]},\"d2\":{\"n\":180,\"mean\":[{\"alpha\":0.975,\"li\":116.1222673281,\"ui\":1000,\"lower\":3.9444444444,\"upper\":5.0277777778,\"t0\":4.2944444444},{\"alpha\":0.99,\"li\":65.367455135,\"ui\":1000,\"lower\":3.8777777778,\"upper\":5.0277777778,\"t0\":4.2944444444}],\"variance\":[{\"alpha\":0.975,\"li\":1,\"ui\":113.3190030054,\"lower\":6.514691358,\"upper\":7.5707927087,\"t0\":7.3188580247},{\"alpha\":0.99,\"li\":1,\"ui\":193.2083507739,\"lower\":6.514691358,\"upper\":7.7243007545,\"t0\":7.3188580247}],\"skewness\":[{\"alpha\":0.975,\"li\":1,\"ui\":756.0338900551,\"lower\":-0.2036519906,\"upper\":0.2044719214,\"t0\":0.0507033364},{\"alpha\":0.99,\"li\":1,\"ui\":844.4640919096,\"lower\":-0.2036519906,\"upper\":0.2360201804,\"t0\":0.0507033364}],\"kurtosis\":[{\"alpha\":0.975,\"li\":258.9014148947,\"ui\":1000,\"lower\":-1.2508617455,\"upper\":-0.7962597972,\"t0\":-1.1354640171},{\"alpha\":0.99,\"li\":183.9448992458,\"ui\":1000,\"lower\":-1.2708226592,\"upper\":-0.7962597972,\"t0\":-1.1354640171}]},\"r\":{\"n\":180,\"pearson\":[{\"alpha\":0.975,\"li\":718.6407551631,\"ui\":1000,\"lower\":0.0998459009,\"upper\":0.2915747314,\"t0\":0.1599199363},{\"alpha\":0.99,\"li\":594.1969904015,\"ui\":1000,\"lower\":0.078386243,\"upper\":0.2915747314,\"t0\":0.1599199363}]}}}]")
    val CI6 = Json.stringify(boot.getCIsByGroupId(benfordRDD, 6))
    CI6 must be("[{\"id\":6,\"level\":2,\"CIs\":{\"d1d2\":{\"n\":220,\"mean\":[{\"alpha\":0.975,\"li\":1.030972707,\"ui\":908.1568489965,\"lower\":33.4899288832,\"upper\":40.8416196421,\"t0\":37.6318181818},{\"alpha\":0.99,\"li\":1,\"ui\":954.998659539,\"lower\":33.4545454545,\"upper\":41.4045331628,\"t0\":37.6318181818}],\"variance\":[{\"alpha\":0.975,\"li\":139.4302490902,\"ui\":1000,\"lower\":562.8283873553,\"upper\":784.5892561983,\"t0\":647.3053512397},{\"alpha\":0.99,\"li\":80.3240391651,\"ui\":1000,\"lower\":548.4567941138,\"upper\":784.5892561983,\"t0\":647.3053512397}],\"skewness\":[{\"alpha\":0.975,\"li\":42.7927829985,\"ui\":998.1867893739,\"lower\":0.5791513056,\"upper\":1.0929476971,\"t0\":0.8000684753},{\"alpha\":0.99,\"li\":20.1804603614,\"ui\":1000,\"lower\":0.5412753599,\"upper\":1.1227775182,\"t0\":0.8000684753}],\"kurtosis\":[{\"alpha\":0.975,\"li\":27.9262196446,\"ui\":997.4955513235,\"lower\":-0.9508863557,\"upper\":0.2106774681,\"t0\":-0.5461403995},{\"alpha\":0.99,\"li\":15.5626946286,\"ui\":1000,\"lower\":-0.9874168367,\"upper\":0.4226413501,\"t0\":-0.5461403995}]},\"d1\":{\"n\":220,\"mean\":[{\"alpha\":0.975,\"li\":1.1124415389,\"ui\":913.5911699558,\"lower\":2.9465832035,\"upper\":3.6636363636,\"t0\":3.3545454545},{\"alpha\":0.99,\"li\":1,\"ui\":957.8691817158,\"lower\":2.9363636364,\"upper\":3.7181818182,\"t0\":3.3545454545}],\"variance\":[{\"alpha\":0.975,\"li\":54.4937518482,\"ui\":999.1632982534,\"lower\":5.2477963803,\"upper\":7.5005306514,\"t0\":6.1742975207},{\"alpha\":0.99,\"li\":27.1010329668,\"ui\":1000,\"lower\":5.0423937803,\"upper\":7.5408264463,\"t0\":6.1742975207}],\"skewness\":[{\"alpha\":0.975,\"li\":36.8681193109,\"ui\":997.6448219615,\"lower\":0.5915858477,\"upper\":1.1237782083,\"t0\":0.8205086823},{\"alpha\":0.99,\"li\":17.3906401707,\"ui\":999.8944242778,\"lower\":0.5630264006,\"upper\":1.1571531017,\"t0\":0.8205086823}],\"kurtosis\":[{\"alpha\":0.975,\"li\":28.6595589823,\"ui\":997.7757167416,\"lower\":-0.9547438529,\"upper\":0.2650426298,\"t0\":-0.5482374624},{\"alpha\":0.99,\"li\":16.2318408491,\"ui\":1000,\"lower\":-0.9873804483,\"upper\":0.518092184,\"t0\":-0.5482374624}]},\"d2\":{\"n\":220,\"mean\":[{\"alpha\":0.975,\"li\":1,\"ui\":892.6907955734,\"lower\":3.6409090909,\"upper\":4.4136363636,\"t0\":4.0863636364},{\"alpha\":0.99,\"li\":1,\"ui\":945.85036977,\"lower\":3.6409090909,\"upper\":4.4993157322,\"t0\":4.0863636364}],\"variance\":[{\"alpha\":0.975,\"li\":914.3637107994,\"ui\":1000,\"lower\":8.9073767324,\"upper\":9.7349380165,\"t0\":9.1243595041},{\"alpha\":0.99,\"li\":851.4821083909,\"ui\":1000,\"lower\":8.730058934,\"upper\":9.7349380165,\"t0\":9.1243595041}],\"skewness\":[{\"alpha\":0.975,\"li\":1,\"ui\":905.7153176824,\"lower\":-0.1439086063,\"upper\":0.2610063134,\"t0\":0.0905031999},{\"alpha\":0.99,\"li\":1,\"ui\":950.7590067121,\"lower\":-0.1439086063,\"upper\":0.2934225129,\"t0\":0.0905031999}],\"kurtosis\":[{\"alpha\":0.975,\"li\":1,\"ui\":37.1668279087,\"lower\":-1.4623943091,\"upper\":-1.3406068464,\"t0\":-1.3547827181},{\"alpha\":0.99,\"li\":1,\"ui\":74.805481389,\"lower\":-1.4623943091,\"upper\":-1.3050958821,\"t0\":-1.3547827181}]},\"r\":{\"n\":220,\"pearson\":[{\"alpha\":0.975,\"li\":535.6351937274,\"ui\":1000,\"lower\":0.0600681478,\"upper\":0.2909563119,\"t0\":0.1382353384},{\"alpha\":0.99,\"li\":400.1601942777,\"ui\":1000,\"lower\":0.0356334999,\"upper\":0.2909563119,\"t0\":0.1382353384}]}}}]")
  }

  test("Benford CIs by Level are correct") {
    val CI1 = boot.getCIsByLevel(benfordRDD, 1)
    Json.stringify(CI1) must be ("[{\"id\":4,\"level\":1,\"CIs\":{\"d1d2\":{\"n\":400,\"mean\":[{\"alpha\":0.975,\"li\":23.0149256044,\"ui\":994.7820505621,\"lower\":36.1401139422,\"upper\":41.6021263517,\"t0\":38.705},{\"alpha\":0.99,\"li\":10.3612086515,\"ui\":998.8379626371,\"lower\":35.7052815146,\"upper\":42.4777131592,\"t0\":38.705}],\"variance\":[{\"alpha\":0.975,\"li\":339.058885733,\"ui\":1000,\"lower\":606.4803654054,\"upper\":754.6114,\"t0\":657.567975},{\"alpha\":0.99,\"li\":229.682472643,\"ui\":1000,\"lower\":593.8206047973,\"upper\":754.6114,\"t0\":657.567975}],\"skewness\":[{\"alpha\":0.975,\"li\":55.8082032789,\"ui\":999.2900084032,\"lower\":0.6426469256,\"upper\":1.0233172063,\"t0\":0.795359968},{\"alpha\":0.99,\"li\":28.123386381,\"ui\":1000,\"lower\":0.6158664303,\"upper\":1.0378126701,\"t0\":0.795359968}],\"kurtosis\":[{\"alpha\":0.975,\"li\":98.7690547018,\"ui\":1000,\"lower\":-0.7611399178,\"upper\":0.1626256694,\"t0\":-0.4949639003},{\"alpha\":0.99,\"li\":60.2555393933,\"ui\":1000,\"lower\":-0.791685984,\"upper\":0.1626256694,\"t0\":-0.4949639003}]},\"d1\":{\"n\":400,\"mean\":[{\"alpha\":0.975,\"li\":22.9010250213,\"ui\":994.802158144,\"lower\":3.195,\"upper\":3.7444775399,\"t0\":3.4525},{\"alpha\":0.99,\"li\":10.4181249868,\"ui\":998.8811125914,\"lower\":3.1603534428,\"upper\":3.8229959006,\"t0\":3.4525}],\"variance\":[{\"alpha\":0.975,\"li\":173.0755028262,\"ui\":1000,\"lower\":5.7178506311,\"upper\":7.13399375,\"t0\":6.27774375},{\"alpha\":0.99,\"li\":101.8444965509,\"ui\":1000,\"lower\":5.5964959402,\"upper\":7.13399375,\"t0\":6.27774375}],\"skewness\":[{\"alpha\":0.975,\"li\":46.8122143692,\"ui\":998.7272119181,\"lower\":0.6643005775,\"upper\":1.0348774853,\"t0\":0.8133183961},{\"alpha\":0.99,\"li\":23.0746018632,\"ui\":1000,\"lower\":0.6354248443,\"upper\":1.0399959201,\"t0\":0.8133183961}],\"kurtosis\":[{\"alpha\":0.975,\"li\":73.8879847106,\"ui\":1000,\"lower\":-0.7856901954,\"upper\":0.1108406376,\"t0\":-0.5086785567},{\"alpha\":0.99,\"li\":44.2816684715,\"ui\":1000,\"lower\":-0.8241238841,\"upper\":0.1108406376,\"t0\":-0.5086785567}]},\"d2\":{\"n\":400,\"mean\":[{\"alpha\":0.975,\"li\":10.1750994387,\"ui\":985.4900674237,\"lower\":3.8638591222,\"upper\":4.5112078728,\"t0\":4.18},{\"alpha\":0.99,\"li\":4.2563000936,\"ui\":995.0576449739,\"lower\":3.8270695466,\"upper\":4.545801954,\"t0\":4.18}],\"variance\":[{\"alpha\":0.975,\"li\":58.7335378387,\"ui\":999.5250726162,\"lower\":7.6608585698,\"upper\":9.4408497978,\"t0\":8.3226},{\"alpha\":0.99,\"li\":30.3071689184,\"ui\":1000,\"lower\":7.5550649077,\"upper\":9.47224375,\"t0\":8.3226}],\"skewness\":[{\"alpha\":0.975,\"li\":1,\"ui\":651.3270885891,\"lower\":-0.1278475388,\"upper\":0.1638533036,\"t0\":0.0643472263},{\"alpha\":0.99,\"li\":1,\"ui\":761.4046568487,\"lower\":-0.1278475388,\"upper\":0.185177447,\"t0\":0.0643472263}],\"kurtosis\":[{\"alpha\":0.975,\"li\":1,\"ui\":589.9497126408,\"lower\":-1.3838953967,\"upper\":-1.1908412209,\"t0\":-1.2604129665},{\"alpha\":0.99,\"li\":1,\"ui\":727.7599517532,\"lower\":-1.3838953967,\"upper\":-1.1654938818,\"t0\":-1.2604129665}]},\"r\":{\"n\":400,\"pearson\":[{\"alpha\":0.975,\"li\":928.9693002026,\"ui\":1000,\"lower\":0.1275337027,\"upper\":0.2356556097,\"t0\":0.148522063},{\"alpha\":0.99,\"li\":870.1463486092,\"ui\":1000,\"lower\":0.1152001107,\"upper\":0.2356556097,\"t0\":0.148522063}]}}},{\"id\":1,\"level\":1,\"CIs\":{\"d1d2\":{\"n\":600,\"mean\":[{\"alpha\":0.975,\"li\":2.7449858386,\"ui\":962.2961310085,\"lower\":35.6896292624,\"upper\":40.4019595458,\"t0\":38.4766666667},{\"alpha\":0.99,\"li\":1,\"ui\":981.4917207356,\"lower\":35.0216666667,\"upper\":40.735,\"t0\":38.4766666667}],\"variance\":[{\"alpha\":0.975,\"li\":3.0724409636,\"ui\":963.2198569971,\"lower\":530.493468463,\"upper\":677.3701445467,\"t0\":615.9761222222},{\"alpha\":0.99,\"li\":1,\"ui\":982.6404468596,\"lower\":490.3311972222,\"upper\":692.1990218957,\"t0\":615.9761222222}],\"skewness\":[{\"alpha\":0.975,\"li\":361.4898862352,\"ui\":1000,\"lower\":0.7405036863,\"upper\":1.0311220714,\"t0\":0.8314262616},{\"alpha\":0.99,\"li\":255.0744186682,\"ui\":1000,\"lower\":0.7201052201,\"upper\":1.0311220714,\"t0\":0.8314262616}],\"kurtosis\":[{\"alpha\":0.975,\"li\":259.7492198658,\"ui\":1000,\"lower\":-0.6501038256,\"upper\":0.0206682774,\"t0\":-0.444126526},{\"alpha\":0.99,\"li\":182.2472090508,\"ui\":1000,\"lower\":-0.683253493,\"upper\":0.0206682774,\"t0\":-0.444126526}]},\"d1\":{\"n\":600,\"mean\":[{\"alpha\":0.975,\"li\":1.0220663331,\"ui\":934.4556999945,\"lower\":3.099659082,\"upper\":3.5874237611,\"t0\":3.4166666667},{\"alpha\":0.99,\"li\":1,\"ui\":965.0212590135,\"lower\":3.0983333333,\"upper\":3.6233333333,\"t0\":3.4166666667}],\"variance\":[{\"alpha\":0.975,\"li\":2.4941035922,\"ui\":958.0296410638,\"lower\":5.1190266419,\"upper\":6.583475444,\"t0\":5.9897222222},{\"alpha\":0.99,\"li\":1,\"ui\":979.6958063657,\"lower\":4.8186638889,\"upper\":6.7179749308,\"t0\":5.9897222222}],\"skewness\":[{\"alpha\":0.975,\"li\":390.0164245005,\"ui\":1000,\"lower\":0.7692711402,\"upper\":1.0554384327,\"t0\":0.8552433321},{\"alpha\":0.99,\"li\":281.11096723,\"ui\":1000,\"lower\":0.7469629946,\"upper\":1.0554384327,\"t0\":0.8552433321}],\"kurtosis\":[{\"alpha\":0.975,\"li\":290.9330201538,\"ui\":1000,\"lower\":-0.6447245458,\"upper\":0.0810984483,\"t0\":-0.4401653371},{\"alpha\":0.99,\"li\":208.7689029554,\"ui\":1000,\"lower\":-0.6730043602,\"upper\":0.0810984483,\"t0\":-0.4401653371}]},\"d2\":{\"n\":600,\"mean\":[{\"alpha\":0.975,\"li\":477.4580915111,\"ui\":1000,\"lower\":4.18,\"upper\":4.5183333333,\"t0\":4.31},{\"alpha\":0.99,\"li\":342.158936731,\"ui\":1000,\"lower\":4.145,\"upper\":4.5183333333,\"t0\":4.31}],\"variance\":[{\"alpha\":0.975,\"li\":1,\"ui\":874.5502229873,\"lower\":7.4822666667,\"upper\":8.5957249974,\"t0\":8.0872333333},{\"alpha\":0.99,\"li\":1,\"ui\":933.9098077183,\"lower\":7.4822666667,\"upper\":8.72154912,\"t0\":8.0872333333}],\"skewness\":[{\"alpha\":0.975,\"li\":1,\"ui\":736.2795672908,\"lower\":-0.0501537476,\"upper\":0.1680564246,\"t0\":0.0830088931},{\"alpha\":0.99,\"li\":1,\"ui\":838.1430335791,\"lower\":-0.0501537476,\"upper\":0.190168033,\"t0\":0.0830088931}],\"kurtosis\":[{\"alpha\":0.975,\"li\":7.7718141518,\"ui\":980.4964913981,\"lower\":-1.3219516076,\"upper\":-1.0981054148,\"t0\":-1.2128782358},{\"alpha\":0.99,\"li\":3.2826904473,\"ui\":993.1355577606,\"lower\":-1.3419525892,\"upper\":-1.0738777736,\"t0\":-1.2128782358}]},\"r\":{\"n\":600,\"pearson\":[{\"alpha\":0.975,\"li\":27.4682189029,\"ui\":995.8535155273,\"lower\":-0.0192248871,\"upper\":0.1590227257,\"t0\":0.0640573854},{\"alpha\":0.99,\"li\":12.2063817199,\"ui\":999.1583767121,\"lower\":-0.0302573005,\"upper\":0.1646797703,\"t0\":0.0640573854}]}}}]")
  }

}
